import{r as c,u as T,aT as z,c as E,a as V,j as e,bq as Q,br as G,bs as F,bt as b,bu as J,bv as y,i as K,aS as M,b3 as j,aH as X,b0 as m,b1 as h,b4 as Y,I as C,B as f,cN as Z,g as ee,h as te,bP as ae}from"./index-dd631538.js";import{F as le,a as v}from"./FormRow-59e55473.js";import{F as ie,a as se,b as W}from"./formik.esm-56d92394.js";import{g as ne,c as oe,s as re,v as ce,d as de}from"./emailSender-300b5ebe.js";const ue=async(t,x)=>{try{const o=await fetch(`https://empowerit-api.vercel.app/cryptoapis/validateWallet?blockchain=${x}&wallet=`+encodeURIComponent(t));if(!o.ok)throw new Error("Network response was not ok");return{status:"success",isValid:(await o.json()).data.item.isValid}}catch(o){return{status:"error",error:o}}};function pe(){const[t,x]=c.useState(),o=T(s=>s.auth.user);c.useEffect(()=>{u()},[o]);const u=async()=>{if(!o.uid)return;const s=await z(E(V,"users",o.uid,"wallets-history"));let p=[];for(const w of s.docs)p.push(w.data());x(p)};return e.jsx("div",{className:"space-y-3",children:t&&t.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-bold text-3xl",children:"Historial de Wallets"}),e.jsxs(Q,{children:[e.jsx(G,{children:e.jsxs(F,{children:[e.jsx(b,{children:"Wallet Anterior"}),e.jsx(b,{children:"Wallet Nueva"}),e.jsx(b,{children:"Divisa"}),e.jsx(b,{children:"Fecha"})]})}),e.jsx(J,{children:t.map((s,p)=>e.jsxs(F,{children:[e.jsx(y,{children:s.prev_wallet==""?"Wallet Eliminada":s.prev_wallet}),e.jsx(y,{children:s.new_wallet==""?"Wallet Eliminada":s.new_wallet}),e.jsx(y,{children:s.type}),e.jsx(y,{children:s.created_at.toDate().toLocaleDateString()})]},p))})]})]})})}const we=()=>{const t=T(a=>a.auth.user),[x,o]=c.useState({wallet_bitcoin:t.wallet_bitcoin,wallet_litecoin:t.wallet_litecoin}),[u,s]=c.useState(!1),[p,w]=c.useState(!1),[d,k]=c.useState(!1),[_,A]=c.useState(!1),[D,I]=c.useState(!1),[B,H]=c.useState(""),R=K(),U=M();c.useEffect(()=>{o({wallet_bitcoin:t.wallet_bitcoin,wallet_litecoin:t.wallet_litecoin})},[t]);const q=(a,l)=>{m.push(e.jsx(h,{title:"Billing information updated",type:"success"}),{placement:"top-center"}),l(!1)},L=(a,l)=>{w(!0);const i=ne();oe(a,i).then(n=>{n&&re(l,i).then(r=>{s(!0),w(!1),m.push(e.jsx(h,{title:"Se envió un código de verificación a tu correo",type:"success"}),{placement:"top-center"})})}).catch(n=>{w(!1),console.log(n)})},O=(a,l)=>{ce(a,l).then(i=>{m.push(e.jsx(h,{title:i?"Código valido":"Código invalido",type:i?"success":"danger"}),{placement:"top-center"}),i&&(s(!1),k(!0),de(a))}).catch(i=>{console.log(i)})},S=(a,l,i)=>{a.length!=0&&ue(a,l).then(async n=>{if(l=="bitcoin"&&A(n.isValid||!1),l=="litecoin"&&I(n.isValid||!1),n.isValid){if(l=="bitcoin"){const r={wallet_bitcoin:a};j(t.uid,r)}if(l=="xrp"){const r={wallet_ripple:a,wallet_ripple_tag:i};j(t.uid,r)}if(l=="litecoin"){const r={wallet_litecoin:a};j(t.uid,r),await N(a,"litecoin")}if(l=="xrp"){const r={wallet_litecoin:a};j(t.uid,r)}}m.push(e.jsx(h,{title:n.isValid?"Wallet Valida":"Wallet Invalida",type:n.isValid?"success":"danger"}),{placement:"top-center"})}).catch(n=>{console.log(n)})},P=async()=>{try{if(t&&t.uid){const a=ee(V,"users",t.uid);await te(a,{wallet_litecoin:""})}await N("","litecoin")}catch(a){console.log("Error a la hora de borrar la wallet",a)}finally{m.push(e.jsx(h,{title:"Wallet eliminada correctamente",type:"success"}),{placement:"top-center"}),U("/home")}},N=async(a,l)=>{!t||!t.uid||await ae(E(V,"users",t.uid,"wallets-history"),{prev_wallet:t.wallet_litecoin,new_wallet:a,type:l,created_at:new Date,email:t.email,user_id:t.uid})};return e.jsxs(e.Fragment,{children:[e.jsx(ie,{enableReinitialize:!0,initialValues:x,onSubmit:async(a,{setSubmitting:l})=>{if(!d||u||!_)return!1;l(!0);try{const i={wallet_bitcoin:a.wallet_bitcoin,wallet_ripple:a.wallet_ripple,wallet_litecoin:a.wallet_litecoin};await j(t.uid,i),R(X({...t,...i})),setTimeout(()=>{q(a,l)},1e3)}catch(i){console.error(i),m.push(e.jsx(h,{title:"Ha ocurrio un error",type:"danger"}),{placement:"top-center"})}},children:({values:a,touched:l,errors:i,isSubmitting:n,resetForm:r})=>{const g={touched:l,errors:i};return e.jsx(se,{children:e.jsxs(Y,{children:[e.jsx(le,{title:"Wallets",desc:""}),e.jsxs(v,{name:"wallet_bitcoin",label:"Dirección Wallet Bitcoin",...g,children:[e.jsx(W,{type:"text",autoComplete:"off",name:"wallet_bitcoin",placeholder:"Wallet Address",component:C,readOnly:!d||_,disabled:!d||_}),e.jsx(f,{className:"mt-2 ltr:mr-2 rtl:ml-2",type:"button",variant:"default",color:"primary",onClick:()=>S(a.wallet_bitcoin,"bitcoin"),hidden:!d,children:"Verificar"})]}),e.jsxs(v,{name:"wallet_litecoin",label:"Dirección Wallet Litecoin",...g,children:[e.jsx(W,{type:"text",autoComplete:"off",name:"wallet_litecoin",placeholder:"Wallet Address",component:C,readOnly:!d||D,disabled:!d||D}),e.jsx(f,{className:"mt-2 ltr:mr-2 rtl:ml-2",type:"button",variant:"default",color:"primary",onClick:()=>S(a.wallet_litecoin,"litecoin"),hidden:!d,children:"Verificar"}),e.jsx(f,{className:"mt-2 ltr:mr-2 rtl:ml-2 ",type:"button",variant:"default",color:"primary",onClick:()=>P(),disabled:t.wallet_litecoin=="",children:"Quitar wallet"})]}),u&&e.jsxs(v,{name:"code",label:"Código",...g,children:[e.jsx(W,{type:"text",autoComplete:"off",name:"code",placeholder:"Código de verificación",component:C,prefix:e.jsx(Z,{className:"text-xl"}),onChange:$=>{H($.currentTarget.value)}}),e.jsx(f,{className:"mt-2 ltr:mr-2 rtl:ml-2 ",type:"button",variant:"default",color:"primary",onClick:()=>O(t.uid,B),children:"Verificar"})]}),e.jsxs("div",{className:"mt-4 ltr:text-right",children:[e.jsx(f,{className:"ltr:mr-2 rtl:ml-2",type:"button",onClick:()=>r,children:"Cancelar"}),e.jsx(f,{className:"mt-2 ltr:mr-2 rtl:ml-2",type:"button",variant:"solid",hidden:u||d,disabled:u||d,loading:p,onClick:()=>L(t.uid,t.email||""),children:"Desbloquear"})]})]})})}}),e.jsx(pe,{})]})};export{we as default};
