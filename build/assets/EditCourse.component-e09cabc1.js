import{r as w,aL as ie,aK as ne,d as b,u as z,j as e,cq as q,cr as B,cu as J,cv as W,D as ae,I as A,B as G,g as K,a as Z,bj as re,bg as oe,b4 as ce,bS as Y,cs as le,bO as T,h as de,b0 as ue,b1 as he}from"./index-dd631538.js";import{F as me,a as fe,b as R}from"./formik.esm-56d92394.js";import{c as xe,a as O}from"./index.esm-65d2e63a.js";import{g as pe,a as ge}from"./Academy.utils-167d070d.js";import{C as _,a as U}from"./Academy.definition-2f8eb162.js";import{u as ve}from"./useLives-8c8f014a.js";import{u as je}from"./utc-3aa391c1.js";import{u as ye}from"./useLessons-42f9f959.js";import{v as Q}from"./v4-4a60fe23.js";const be=i=>{const[a,h]=w.useState([]),[o,n]=w.useState(!1),[p,j]=w.useState(null);return w.useEffect(()=>{n(!0),pe(i===_.LEADERSHIP).then($=>{$.data?h($.data):h([])}).finally(()=>{n(!1)})},[]),{data:a,isLoading:o,courseById:p,fetchCourseById:($,N)=>{n(!0),ge($===_.LEADERSHIP,N).then(C=>{j(C.data)}).finally(()=>{n(!1)})}}};var X={exports:{}};(function(i,a){(function(h,o){i.exports=o()})(ie,function(){var h,o,n=1e3,p=6e4,j=36e5,F=864e5,$=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,N=31536e6,C=2628e6,M=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/,I={years:N,months:C,days:F,hours:j,minutes:p,seconds:n,milliseconds:1,weeks:6048e5},E=function(c){return c instanceof D},r=function(c,t,s){return new D(c,s,t.$l)},m=function(c){return o.p(c)+"s"},L=function(c){return c<0},g=function(c){return L(c)?Math.ceil(c):Math.floor(c)},l=function(c){return Math.abs(c)},u=function(c,t){return c?L(c)?{negative:!0,format:""+l(c)+t}:{negative:!1,format:""+c+t}:{negative:!1,format:""}},D=function(){function c(s,d,x){var f=this;if(this.$d={},this.$l=x,s===void 0&&(this.$ms=0,this.parseFromMilliseconds()),d)return r(s*I[m(d)],this);if(typeof s=="number")return this.$ms=s,this.parseFromMilliseconds(),this;if(typeof s=="object")return Object.keys(s).forEach(function(P){f.$d[m(P)]=s[P]}),this.calMilliseconds(),this;if(typeof s=="string"){var v=s.match(M);if(v){var y=v.slice(2).map(function(P){return P!=null?Number(P):0});return this.$d.years=y[0],this.$d.months=y[1],this.$d.weeks=y[2],this.$d.days=y[3],this.$d.hours=y[4],this.$d.minutes=y[5],this.$d.seconds=y[6],this.calMilliseconds(),this}}return this}var t=c.prototype;return t.calMilliseconds=function(){var s=this;this.$ms=Object.keys(this.$d).reduce(function(d,x){return d+(s.$d[x]||0)*I[x]},0)},t.parseFromMilliseconds=function(){var s=this.$ms;this.$d.years=g(s/N),s%=N,this.$d.months=g(s/C),s%=C,this.$d.days=g(s/F),s%=F,this.$d.hours=g(s/j),s%=j,this.$d.minutes=g(s/p),s%=p,this.$d.seconds=g(s/n),s%=n,this.$d.milliseconds=s},t.toISOString=function(){var s=u(this.$d.years,"Y"),d=u(this.$d.months,"M"),x=+this.$d.days||0;this.$d.weeks&&(x+=7*this.$d.weeks);var f=u(x,"D"),v=u(this.$d.hours,"H"),y=u(this.$d.minutes,"M"),P=this.$d.seconds||0;this.$d.milliseconds&&(P+=this.$d.milliseconds/1e3,P=Math.round(1e3*P)/1e3);var k=u(P,"S"),se=s.negative||d.negative||f.negative||v.negative||y.negative||k.negative,te=v.format||y.format||k.format?"T":"",H=(se?"-":"")+"P"+s.format+d.format+f.format+te+v.format+y.format+k.format;return H==="P"||H==="-P"?"P0D":H},t.toJSON=function(){return this.toISOString()},t.format=function(s){var d=s||"YYYY-MM-DDTHH:mm:ss",x={Y:this.$d.years,YY:o.s(this.$d.years,2,"0"),YYYY:o.s(this.$d.years,4,"0"),M:this.$d.months,MM:o.s(this.$d.months,2,"0"),D:this.$d.days,DD:o.s(this.$d.days,2,"0"),H:this.$d.hours,HH:o.s(this.$d.hours,2,"0"),m:this.$d.minutes,mm:o.s(this.$d.minutes,2,"0"),s:this.$d.seconds,ss:o.s(this.$d.seconds,2,"0"),SSS:o.s(this.$d.milliseconds,3,"0")};return d.replace($,function(f,v){return v||String(x[f])})},t.as=function(s){return this.$ms/I[m(s)]},t.get=function(s){var d=this.$ms,x=m(s);return x==="milliseconds"?d%=1e3:d=x==="weeks"?g(d/I[x]):this.$d[x],d||0},t.add=function(s,d,x){var f;return f=d?s*I[m(d)]:E(s)?s.$ms:r(s,this).$ms,r(this.$ms+f*(x?-1:1),this)},t.subtract=function(s,d){return this.add(s,d,!0)},t.locale=function(s){var d=this.clone();return d.$l=s,d},t.clone=function(){return r(this.$ms,this)},t.humanize=function(s){return h().add(this.$ms,"ms").locale(this.$l).fromNow(!s)},t.valueOf=function(){return this.asMilliseconds()},t.milliseconds=function(){return this.get("milliseconds")},t.asMilliseconds=function(){return this.as("milliseconds")},t.seconds=function(){return this.get("seconds")},t.asSeconds=function(){return this.as("seconds")},t.minutes=function(){return this.get("minutes")},t.asMinutes=function(){return this.as("minutes")},t.hours=function(){return this.get("hours")},t.asHours=function(){return this.as("hours")},t.days=function(){return this.get("days")},t.asDays=function(){return this.as("days")},t.weeks=function(){return this.get("weeks")},t.asWeeks=function(){return this.as("weeks")},t.months=function(){return this.get("months")},t.asMonths=function(){return this.as("months")},t.years=function(){return this.get("years")},t.asYears=function(){return this.as("years")},c}(),S=function(c,t,s){return c.add(t.years()*s,"y").add(t.months()*s,"M").add(t.days()*s,"d").add(t.hours()*s,"h").add(t.minutes()*s,"m").add(t.seconds()*s,"s").add(t.milliseconds()*s,"ms")};return function(c,t,s){h=s,o=s().$utils(),s.duration=function(f,v){var y=s.locale();return r(f,{$l:y},v)},s.isDuration=E;var d=t.prototype.add,x=t.prototype.subtract;t.prototype.add=function(f,v){return E(f)?S(this,f,1):d.bind(this)(f,v)},t.prototype.subtract=function(f,v){return E(f)?S(this,f,-1):x.bind(this)(f,v)}}})})(X);var $e=X.exports;const ee=ne($e);b.extend(ee);b.extend(je);const Se=({live:i,...a})=>{var p;const h=z(j=>j.auth.user),o=b().subtract(i.played_seconds||0,"seconds"),n=b.duration(b().diff(o));return e.jsxs("div",{className:"flex flex-col 2xl:flex-row 2xl:space-x-2",children:[e.jsx("img",{src:i.image_cover,className:"aspect-video w-full 2xl:w-[200px] hover:brightness-125"}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[!a.hidePlay&&e.jsx("span",{className:"text-blue-500 hover:underline font-semibold",children:"Ver Ahora"}),e.jsx("span",{children:b(i.date.seconds*1e3).format("DD MMMM YYYY")}),e.jsxs("span",{children:["Duración: ",e.jsx("b",{children:i.duration})]}),((p=h.authority)==null?void 0:p.includes("ADMIN"))&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["Cantidad de vistas: ",e.jsx("b",{children:i.count_views})]}),e.jsxs("span",{children:["Tiempo de reproducción:"," ",e.jsx("b",{children:b.utc(n.asMilliseconds()).format("HH:mm:ss")})]})]})]})]})};b.extend(ee);const we=({lesson:i,...a})=>{var p;const h=z(j=>j.auth.user),o=b().subtract(i.played_seconds||0,"seconds"),n=b.duration(b().diff(o));return e.jsxs("div",{className:"flex flex-col 2xl:flex-row 2xl:space-x-2",children:[e.jsx("img",{src:i.image_cover,className:"aspect-video w-full 2xl:w-[200px] hover:brightness-125"}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[!a.hidePlay&&e.jsx("span",{className:"text-blue-500 hover:underline font-semibold",children:"Ver Ahora"}),e.jsxs("span",{children:["Duración: ",e.jsx("b",{children:i.duration})]}),((p=h.authority)==null?void 0:p.includes("ADMIN"))&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:["Cantidad de vistas: ",e.jsx("b",{children:i.count_views})]}),e.jsxs("span",{children:["Tiempo de reproducción:"," ",e.jsx("b",{children:b.utc(n.asMilliseconds()).format("HH:mm:ss")})]})]})]})]})},Ce={"image/jpeg":"jpeg","image/jpg":"jpg","image/png":"png"},Le=async(i,a,h)=>{const o=a+"/"+i+"."+Ce[h.type],n=q(B,o);return await J(n,h),await W(n)},V=i=>{const[a,h]=w.useState(!1),[o,n]=w.useState({name:"",description:"",duration:"",order:i.orderIndex||1,image_cover:null}),[p,j]=w.useState(null),[F,$]=w.useState(null),N=i.isLeadership?_.LEADERSHIP:_.STANDARD,C=i.isLive?U.LIVE:U.LESSON,M=(r,m)=>{n(L=>({...L,[r]:m}))},I=r=>{var L;const m=(L=r.target.files)==null?void 0:L[0];n(g=>({...g,image_cover:m}))},E=async()=>{try{if($(null),!p||!o.image_cover||i.isLive&&!o.date)return;h(!0);const r=Q(),m={...o};i.isLive&&(m.date=b(o.date+" 21:00:00").toDate());const L=await Le("image_cover",`${N}/${i.courseId}/${C}/${r}`,o.image_cover);m.image_cover=L;const g=await fetch("https://empowerit-api.vercel.app/cloudflare/uploadVideo",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({folder:C,courseId:i.courseId,courseType:N})}).then(u=>u.json());await fetch(g.url,{method:"PUT",body:p,headers:{"Content-Type":"video/mp4"}}),m.record_link="https://pub-38820717e1d6434b9216f051cc6914fb.r2.dev/"+g.filename;const l=K(Z,`${N}/${i.courseId}/${C}/${r}`);await re(l,m),i.onClose()}catch(r){console.error(r),$("Algo salió mal, intenta de nuevo")}finally{h(!1)}};return e.jsx(ae,{isOpen:i.show,onClose:a?void 0:i.onClose,children:e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsx("h3",{children:i.isLive?"Subir Live":"Subir Lección"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{children:"Nombre"}),e.jsx(A,{disabled:a,placeholder:"name",onChange:r=>M("name",r.target.value)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{children:"Descripción"}),e.jsx(A,{disabled:a,placeholder:"description",onChange:r=>M("description",r.target.value)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{children:"Posición en el curso"}),e.jsx(A,{disabled:a,placeholder:"Posición del video",onChange:r=>M("order",r.target.value)})]}),i.isLive&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{children:"Fecha"}),e.jsx(A,{disabled:a,placeholder:"date",type:"date",onChange:r=>M("date",r.target.value)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{children:"Duración"}),e.jsx(A,{disabled:a,placeholder:"00:00",onChange:r=>M("duration",r.target.value)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{children:"Imagen de portada (.jpg, .png, .jpeg)"}),e.jsx(A,{disabled:a,placeholder:"image_cover",type:"file",accept:".jpg,.png,.jpeg",onChange:I})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{children:"Archivo de video (.mp4)"}),e.jsx(A,{disabled:a,placeholder:"video_file",type:"file",accept:".mp4",onChange:r=>{var m;return j(((m=r.target.files)==null?void 0:m[0])||null)}})]}),e.jsxs("div",{children:[e.jsx(G,{className:"w-full",loading:a,onClick:E,color:"primary",children:a?"Subiendo... esto puede tardar varios minutos":"Subir"}),F&&e.jsx("span",{className:"text-red-500",children:F})]})]})})},ke=()=>{const{courseId:i}=oe(),[a]=w.useState(window.location.pathname.includes("academy-leadership")?_.LEADERSHIP:_.STANDARD),h=q(B,"courses-images/"+Q()),{isLoading:o,courseById:n,fetchCourseById:p}=be(a),{data:j,isLoading:F}=ve(a,i,!0),{data:$,isLoading:N}=ye(a,i,!0),[C,M]=w.useState(!1),[I,E]=w.useState(!1),r=(l,u,D)=>{l.setFieldValue(a,D[0]),l.setFieldValue("coursesPreview",URL.createObjectURL(D[0]))},m=async l=>(await J(h,l),await W(h)),L=async(l,{resetForm:u})=>{const D=await m(l.courses);try{let S;a&&i&&(S=K(Z,a,i),await de(S,{name:l.name,description:l.description,image_cover:D}),ue.push(e.jsx(he,{title:"Curso actualizado con éxito",type:"success"}),{placement:"top-center"}))}catch(S){console.log(S)}};w.useEffect(()=>{i&&p(a,i)},[i]);const g=xe().shape({name:O().required("Por favor introduzca el nombre del curso"),description:O().required("Por favor introduzca la descripción del curso")});return o||!i?"Cargando cursos":e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-xl",children:"Editar curso"}),e.jsx("br",{}),e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsx("div",{className:"w-full lg:w-1/2",children:e.jsx(me,{initialValues:{name:(n==null?void 0:n.name)||"",description:(n==null?void 0:n.description)||"",image_cover:(n==null?void 0:n.image_cover)||""},validationSchema:g,onSubmit:L,children:({touched:l,errors:u})=>e.jsx(fe,{children:e.jsxs(ce,{children:[e.jsx(Y,{label:"Nombre",invalid:u.name&&l.name,errorMessage:u.name,children:e.jsx(R,{type:"text",autoComplete:"off",name:"name",placeholder:"Nombre del Curso",component:A})}),e.jsx(Y,{label:"Descripción",invalid:u.description&&l.description,errorMessage:u.description,children:e.jsx(R,{type:"text",autoComplete:"off",name:"description",placeholder:"Descripción del Curso",component:A})}),e.jsx(Y,{label:"Imagen del Curso",children:e.jsx(R,{name:"courses",children:({field:D,form:S})=>{const c=S.values.coursesPreview?{src:S.values.coursesPreview}:n!=null&&n.image_cover?{src:n.image_cover}:{};return e.jsx(le,{className:"cursor-pointer",showList:!1,uploadLimit:1,onChange:t=>r(S,D,t),onFileRemove:t=>r(S,D,t),children:e.jsx("img",{src:c.src,className:"border-2 border-white dark:border-gray-800 shadow-lg",width:200,height:160})})}})}),e.jsx(G,{block:!0,variant:"solid",type:"submit",children:"Actualizar Curso"})]})})})}),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsxs("h3",{className:"flex space-x-2",children:[e.jsx("span",{children:"Lecciones"}),e.jsx("button",{className:"text-sm text-white bg-blue-700 rounded-full p-1 h-6 w-6 flex items-center justify-center",title:"Subir video",onClick:()=>E(!0),children:e.jsx(T,{size:8})})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4",children:$.sort((l,u)=>l.order-u.order).map(l=>e.jsx("div",{children:e.jsx(we,{hidePlay:!0,lesson:l})},l.id))}),e.jsx(V,{show:I,courseId:i,orderIndex:$.length,isLeadership:a===_.LEADERSHIP,isLive:!1,onClose:()=>E(!1)})]})}),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsxs("h3",{className:"flex space-x-2",children:[e.jsx("span",{children:"Lives"}),e.jsx("button",{className:"text-sm text-white bg-blue-700 rounded-full p-1 h-6 w-6 flex items-center justify-center",title:"Subir video",onClick:()=>M(!0),children:e.jsx(T,{size:8})})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4",children:j.sort((l,u)=>l.order-u.order).map(l=>e.jsx("div",{children:e.jsx(Se,{hidePlay:!0,live:l})},l.id))}),e.jsx(V,{isLive:!0,show:C,courseId:i,isLeadership:a===_.LEADERSHIP,onClose:()=>M(!1)})]})})]})]})};export{ke as default};
