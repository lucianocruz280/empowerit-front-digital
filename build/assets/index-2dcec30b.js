import{r,j as s,D,I as z,B as c,bq as E,br as I,bs as v,bt as l,bu as P,bv as t,d as U,aT as B,aU as Y,aW as H,bR as O,a as h,aD as G,g as u,h as N}from"./index-dd631538.js";const A=()=>{const[p,f]=r.useState([]),[a,C]=r.useState(null),[m,b]=r.useState(""),[k,g]=r.useState(!1),[y,S]=r.useState(null),T=async()=>{var d,x;const e=await B(Y(O(h,"pending-ships"),H("created_at","desc"))),n=[];for(const i of e.docs){const o=await G(u(h,`users/${(x=(d=i.ref.parent)==null?void 0:d.parent)==null?void 0:x.id}`)),j=await G(u(h,`users/${o.get("sponsor_id")}`));n.push({...i.data(),ref_path:i.ref.path,user:{...o.data(),id:o.id},sponsor:{...j.data(),id:j.id}})}f(n)};r.useEffect(()=>{T()},[]);const w=async(e,n)=>{await N(u(h,e),{sent:!0,sent_at:new Date});const d=[...p];d[n].sent=!0,f(d)},_=async(e,n,d)=>{S(n),b(d),g(!0)},M=async()=>{if(y!==null){const e=p[y].ref_path;await N(u(h,e),{guide:m});const n=[...p];n[y].guide=m,f(n),g(!1),b("")}},q=e=>{e.json&&C({...e,json:JSON.parse(e.json)})};return s.jsxs("div",{className:"flex flex-col space-y-8 w-full",children:[s.jsx(D,{isOpen:a!==null,onClose:()=>C(null),children:s.jsxs("div",{className:"flex",children:[s.jsxs("div",{className:"flex-1",children:["Estado: ",a==null?void 0:a.address.state,s.jsx("br",{}),"Ciudad: ",a==null?void 0:a.address.city,s.jsx("br",{}),"Colonia: ",a==null?void 0:a.address.colony,s.jsx("br",{}),"Calle: ",a==null?void 0:a.address.street,s.jsx("br",{}),"CP: ",a==null?void 0:a.address.cp,s.jsx("br",{}),"Referencia: ",a==null?void 0:a.address.reference,s.jsx("br",{}),"num exterior: ",a==null?void 0:a.address.num_ext,s.jsx("br",{}),"num interior: ",a==null?void 0:a.address.num_int,s.jsx("br",{}),"Télefono: ",a==null?void 0:a.address.phone,s.jsx("br",{})]}),s.jsx("div",{className:"pr-8",children:s.jsx("ul",{children:a==null?void 0:a.json.filter(e=>e.quantity).map(e=>s.jsxs("li",{children:[e.quantity," x ",e.name]},e.id))})})]})}),s.jsx(D,{isOpen:k,onClose:()=>g(!1),children:s.jsxs("div",{className:"space-y-2",children:[s.jsx("p",{className:"text-lg font-semibold",children:"Ingrese la guía"}),s.jsx(z,{type:"text",onChange:e=>b(e.target.value),value:m}),s.jsx(c,{onClick:M,children:"Agregar Guia"})]})}),s.jsxs(E,{children:[s.jsx(I,{children:s.jsxs(v,{children:[s.jsx(l,{children:"Correo"}),s.jsx(l,{children:"Nombre"}),s.jsx(l,{children:"Paquete"}),s.jsx(l,{children:"Patrocinador"}),s.jsx(l,{children:"Patrocinador Correo"}),s.jsx(l,{children:"Fecha de creación de pedido"}),s.jsx(l,{children:"Detalles de envío"})]})}),s.jsx(P,{children:p.map((e,n)=>{var d,x,i,o,j;return s.jsxs(v,{children:[s.jsx(t,{children:(d=e.user)==null?void 0:d.email}),s.jsx(t,{children:(x=e.user)==null?void 0:x.name}),s.jsx(t,{children:e.pack}),s.jsx(t,{children:(i=e.sponsor)==null?void 0:i.name}),s.jsx(t,{children:(o=e.sponsor)==null?void 0:o.email}),s.jsx(t,{children:U(((j=e==null?void 0:e.created_at)==null?void 0:j.seconds)*1e3).format("YYYY-MM-DD HH:mm:ss")}),s.jsxs(t,{className:"flex flex-col",children:[s.jsx(c,{size:"sm",onClick:()=>q(e.cart),children:"Ver detalles"}),e.sent=="false"||e.sent==!1?s.jsx(c,{size:"sm",onClick:()=>w(e.ref_path,n),children:"Marcar como enviado"}):s.jsx(c,{size:"sm",disabled:!0,children:"Enviado"}),e.guide?s.jsx(c,{size:"sm",onClick:()=>_(e.ref_path,n,e.guide),children:"Guía añadida"}):s.jsx(c,{size:"sm",onClick:()=>_(e.ref_path,n,""),children:"Agregar Guia"})]})]},n)})})]})]})};export{A as default};
