import{bg as _,r as u,j as s,q as f,b as v,bh as j,c as I,a as d,g as l,o as L,bi as b,bj as y,U as P,u as N,aD as R,aB as T,bf as w}from"./index-dd631538.js";import{u as D}from"./useLessons-42f9f959.js";import{u as E}from"./useLives-8c8f014a.js";import{A,C as m}from"./Academy.definition-2f8eb162.js";import{v as C}from"./v4-4a60fe23.js";const O=()=>{const{courseId:n,lessonId:e,academyType:i}=_(),[t]=u.useState(!!window.location.pathname.includes("live")),a=i==A.LEADERSHIP?m.LEADERSHIP:m.STANDARD,{data:r}=D(a,n),{data:o}=E(a,n);return s.jsx("div",{className:"flex flex-col w-full space-y-2",children:t?o.map(c=>s.jsx(f,{to:`/${i}/course/${n}/live/${c.id}`,children:s.jsxs("div",{className:v("hover:bg-gray-200 px-4 py-3 rounded-md hover:cursor-pointer",{"bg-blue-200":e==c.id}),children:[s.jsx("p",{className:"line-clamp-1 text-ellipsis font-semibold",children:c.description}),s.jsxs("span",{className:"flex items-center space-x-1",children:[s.jsx(j,{}),s.jsx("span",{children:c.duration})]})]})},c.id)):r.map(c=>s.jsx(f,{to:`/${i}/course/${n}/lesson/${c.id}`,children:s.jsxs("div",{className:v("hover:bg-gray-200 px-4 py-3 rounded-md hover:cursor-pointer",{"bg-blue-200":e==c.id}),children:[s.jsx("p",{className:"line-clamp-1 text-ellipsis font-semibold",children:c.name}),s.jsxs("span",{className:"flex items-center space-x-1",children:[s.jsx(j,{}),s.jsx("span",{children:c.duration})]})]})},c.id))})},B=n=>{const{lesson:e}=n;return s.jsxs("div",{className:"flex flex-col w-full text-left px-4 py-8 space-y-[8px]",children:[s.jsx("h5",{children:e.name}),s.jsx("p",{children:e.description||""})]})},p="_counter_shards_";class x{constructor(e,i){this.shards={},this.notifyPromise=null,this.doc=e,this.field=i,this.db=e.firestore,this.shardId=V();const t=I(d,this.doc.path,p);this.shards[this.doc.path]=0,this.shards[l(d,t.path,this.shardId).path]=0,this.shards[l(d,t.path,"	"+this.shardId.slice(0,4)).path]=0,this.shards[l(d,t.path,"		"+this.shardId.slice(0,3)).path]=0,this.shards[l(d,t.path,"			"+this.shardId.slice(0,2)).path]=0,this.shards[l(d,t.path,"				"+this.shardId.slice(0,1)).path]=0}async get(e){const i=Object.keys(this.shards).map(async a=>(await this.db.doc(a).get(e)).get(this.field)||0);return(await Promise.all(i)).reduce((a,r)=>a+r,0)}onSnapshot(e){Object.keys(this.shards).forEach(i=>{L(l(this.db,i),t=>{this.shards[t.ref.path]=t.get(this.field)||0,this.notifyPromise===null&&(this.notifyPromise=k(()=>{const a=Object.values(this.shards).reduce((r,o)=>r+o,0);e({exists:!0,data:()=>a}),this.notifyPromise=null}))})})}incrementBy(e){const i=b(e),t=this.field.split(".").reverse().reduce((r,o)=>({[o]:r}),i),a=l(d,this.doc.path,p,this.shardId);return y(a,t,{merge:!0})}decreaseBy(e){const i=b(e*-1),t=this.field.split(".").reverse().reduce((r,o)=>({[o]:r}),i),a=l(d,this.doc.path,p,this.shardId);return y(a,t,{merge:!0})}shard(){return this.doc.collection(p).doc(this.shardId)}}async function k(n){return new Promise(e=>{setTimeout(async()=>{const i=n();e(i)},0)})}function V(){return C()}const H=(n,e,i,t)=>{const a=l(d,`${n}/${e}/lessons/${i}`);new x(a,"count_views").incrementBy(1);const o=l(d,`${n}/${e}/lessons/${i}/users/${t}`);new x(o,"count_views").incrementBy(1)},M=(n,e,i,t)=>{const a=l(d,`${n}/${e}/lives/${i}`);new x(a,"count_views").incrementBy(1);const o=l(d,`${n}/${e}/lives/${i}/users/${t}`);new x(o,"count_views").incrementBy(1)},U=u.lazy(()=>P(()=>import("./Player-be1be784.js").then(n=>n.P),["assets/Player-be1be784.js","assets/index-dd631538.js","assets/index-95460e68.css"])),{TabNav:q,TabList:z}=w,g={description:{label:"DescripciÃ³n",path:"description"}},F=()=>{const[n]=u.useState(!!window.location.pathname.includes("live")),[e]=u.useState(window.location.pathname.includes("academy-leadership")?m.LEADERSHIP:m.STANDARD),i=N(h=>h.auth.user),{courseId:t,lessonId:a}=_(),[r,o]=u.useState("description"),[c,$]=u.useState({});u.useEffect(()=>{n?M(e,t,a,i.uid):H(e,t,a,i.uid),R(l(d,`${e}/`+t+`/${n?"lives":"lessons"}/`+a)).then(h=>$({id:h.id,...h.data()}))},[t,a]);const S=h=>{o(h)};return s.jsxs("div",{className:"flex flex-col md:flex-row md:space-x-4 w-full h-fit",children:[s.jsxs("div",{className:"w-[80%]",children:[s.jsx(T.Suspense,{fallback:s.jsx("div",{children:"Loading..."}),children:c.record_link?s.jsx(U,{courseId:t,lesson:c,isLive:n,courseType:e}):s.jsx("span",{children:"Loading..."})}),s.jsx(w,{value:r,onChange:h=>S(h),children:s.jsx(z,{children:Object.keys(g).map(h=>s.jsx(q,{value:h,children:g[h].label},h))})}),r==="description"&&s.jsx(B,{lesson:c}),r==="questions"&&s.jsx("span",{children:"Preguntas"}),r==="comments"&&s.jsx("span",{children:"Comentarios"})]}),s.jsx("div",{className:"flex flex-col w-[20%]",children:s.jsx(O,{})})]})},X=Object.freeze(Object.defineProperty({__proto__:null,default:F},Symbol.toStringTag,{value:"Module"}));export{x as C,X as i};
