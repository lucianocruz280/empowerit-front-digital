import{aK as ye,bJ as be,bK as $e,aB as Ae,r as f,aL as qe,d as se,u as Be,bL as de,aU as ce,c as U,a as z,aX as H,aW as ue,aT as F,g as fe,aD as pe,j as n,S as A,b as K,bq as he,br as ve,bs as me,bt as R,bu as ge}from"./index-dd631538.js";import{e as Ue}from"./index-540cc576.js";import{u as Fe}from"./utc-3aa391c1.js";var E={},k={},Se={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var e=1,s=function(){return"".concat(e++)};r.default=s})(Se);var V={},W={},ne={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var e=function(t){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:60,i=null;return function(){for(var d=this,p=arguments.length,h=new Array(p),_=0;_<p;_++)h[_]=arguments[_];clearTimeout(i),i=setTimeout(function(){t.apply(d,h)},a)}};r.default=e})(ne);var S={};Object.defineProperty(S,"__esModule",{value:!0});S.SizeSensorId=S.SensorTabIndex=S.SensorClassName=void 0;var Ve="size-sensor-id";S.SizeSensorId=Ve;var We="size-sensor-object";S.SensorClassName=We;var Ge="-1";S.SensorTabIndex=Ge;Object.defineProperty(W,"__esModule",{value:!0});W.createSensor=void 0;var Je=Ye(ne),Q=S;function Ye(r){return r&&r.__esModule?r:{default:r}}var Xe=function(e,s){var t=void 0,a=[],i=function(){getComputedStyle(e).position==="static"&&(e.style.position="relative");var o=document.createElement("object");return o.onload=function(){o.contentDocument.defaultView.addEventListener("resize",d),d()},o.style.display="block",o.style.position="absolute",o.style.top="0",o.style.left="0",o.style.height="100%",o.style.width="100%",o.style.overflow="hidden",o.style.pointerEvents="none",o.style.zIndex="-1",o.style.opacity="0",o.setAttribute("class",Q.SensorClassName),o.setAttribute("tabindex",Q.SensorTabIndex),o.type="text/html",e.appendChild(o),o.data="about:blank",o},d=(0,Je.default)(function(){a.forEach(function(g){g(e)})}),p=function(o){t||(t=i()),a.indexOf(o)===-1&&a.push(o)},h=function(){t&&t.parentNode&&(t.contentDocument&&t.contentDocument.defaultView.removeEventListener("resize",d),t.parentNode.removeChild(t),e.removeAttribute(Q.SizeSensorId),t=void 0,a=[],s&&s())},_=function(o){var b=a.indexOf(o);b!==-1&&a.splice(b,1),a.length===0&&t&&h()};return{element:e,bind:p,destroy:h,unbind:_}};W.createSensor=Xe;var G={};Object.defineProperty(G,"__esModule",{value:!0});G.createSensor=void 0;var He=S,Ke=Qe(ne);function Qe(r){return r&&r.__esModule?r:{default:r}}var Ze=function(e,s){var t=void 0,a=[],i=(0,Ke.default)(function(){a.forEach(function(g){g(e)})}),d=function(){var o=new ResizeObserver(i);return o.observe(e),i(),o},p=function(o){t||(t=d()),a.indexOf(o)===-1&&a.push(o)},h=function(){t.disconnect(),a=[],t=void 0,e.removeAttribute(He.SizeSensorId),s&&s()},_=function(o){var b=a.indexOf(o);b!==-1&&a.splice(b,1),a.length===0&&t&&h()};return{element:e,bind:p,destroy:h,unbind:_}};G.createSensor=Ze;Object.defineProperty(V,"__esModule",{value:!0});V.createSensor=void 0;var et=W,tt=G,st=typeof ResizeObserver<"u"?tt.createSensor:et.createSensor;V.createSensor=st;Object.defineProperty(k,"__esModule",{value:!0});k.removeSensor=k.getSensor=k.Sensors=void 0;var nt=at(Se),rt=V,ee=S;function at(r){return r&&r.__esModule?r:{default:r}}var T={};k.Sensors=T;function je(r){r&&T[r]&&delete T[r]}var it=function(e){var s=e.getAttribute(ee.SizeSensorId);if(s&&T[s])return T[s];var t=(0,nt.default)();e.setAttribute(ee.SizeSensorId,t);var a=(0,rt.createSensor)(e,function(){return je(t)});return T[t]=a,a};k.getSensor=it;var ot=function(e){var s=e.element.getAttribute(ee.SizeSensorId);e.destroy(),je(s)};k.removeSensor=ot;Object.defineProperty(E,"__esModule",{value:!0});E.ver=Ne=E.clear=we=E.bind=void 0;var te=k,lt=function(e,s){var t=(0,te.getSensor)(e);return t.bind(s),function(){t.unbind(s)}},we=E.bind=lt,dt=function(e){var s=(0,te.getSensor)(e);(0,te.removeSensor)(s)},Ne=E.clear=dt,ct="1.0.2";E.ver=ct;function xe(r,e){var s={};return e.forEach(function(t){s[t]=r[t]}),s}function Z(r){return typeof r=="function"}function ut(r){return typeof r=="string"}var ft=function r(e,s){if(e===s)return!0;if(e&&s&&typeof e=="object"&&typeof s=="object"){if(e.constructor!==s.constructor)return!1;var t,a,i;if(Array.isArray(e)){if(t=e.length,t!=s.length)return!1;for(a=t;a--!==0;)if(!r(e[a],s[a]))return!1;return!0}if(e.constructor===RegExp)return e.source===s.source&&e.flags===s.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===s.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===s.toString();if(i=Object.keys(e),t=i.length,t!==Object.keys(s).length)return!1;for(a=t;a--!==0;)if(!Object.prototype.hasOwnProperty.call(s,i[a]))return!1;for(a=t;a--!==0;){var d=i[a];if(!r(e[d],s[d]))return!1}return!0}return e!==e&&s!==s};const I=ye(ft);var pt=function(r){be(e,r);function e(s){var t=r.call(this,s)||this;return t.echarts=s.echarts,t.ele=null,t.isInitialResize=!0,t}return e.prototype.componentDidMount=function(){this.renderNewEcharts()},e.prototype.componentDidUpdate=function(s){var t=this.props.shouldSetOption;if(!(Z(t)&&!t(s,this.props))){if(!I(s.theme,this.props.theme)||!I(s.opts,this.props.opts)||!I(s.onEvents,this.props.onEvents)){this.dispose(),this.renderNewEcharts();return}var a=["option","notMerge","lazyUpdate","showLoading","loadingOption"];I(xe(this.props,a),xe(s,a))||this.updateEChartsOption(),(!I(s.style,this.props.style)||!I(s.className,this.props.className))&&this.resize()}},e.prototype.componentWillUnmount=function(){this.dispose()},e.prototype.getEchartsInstance=function(){return this.echarts.getInstanceByDom(this.ele)||this.echarts.init(this.ele,this.props.theme,this.props.opts)},e.prototype.dispose=function(){if(this.ele){try{Ne(this.ele)}catch(s){console.warn(s)}this.echarts.dispose(this.ele)}},e.prototype.renderNewEcharts=function(){var s=this,t=this.props,a=t.onEvents,i=t.onChartReady,d=this.updateEChartsOption();this.bindEvents(d,a||{}),Z(i)&&i(d),this.ele&&we(this.ele,function(){s.resize()})},e.prototype.bindEvents=function(s,t){function a(d,p){ut(d)&&Z(p)&&s.on(d,function(h){p(h,s)})}for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&a(i,t[i])},e.prototype.updateEChartsOption=function(){var s=this.props,t=s.option,a=s.notMerge,i=a===void 0?!1:a,d=s.lazyUpdate,p=d===void 0?!1:d,h=s.showLoading,_=s.loadingOption,g=_===void 0?null:_,o=this.getEchartsInstance();return o.setOption(t,i,p),h?o.showLoading(g):o.hideLoading(),o},e.prototype.resize=function(){var s=this.getEchartsInstance();if(!this.isInitialResize)try{s.resize()}catch(t){console.warn(t)}this.isInitialResize=!1},e.prototype.render=function(){var s=this,t=this.props,a=t.style,i=t.className,d=i===void 0?"":i,p=$e({height:300},a);return Ae.createElement("div",{ref:function(h){s.ele=h},style:p,className:"echarts-for-react "+d})},e}(f.PureComponent),_e=function(r){be(e,r);function e(s){var t=r.call(this,s)||this;return t.echarts=Ue,t}return e}(pt),De={exports:{}};(function(r,e){(function(s,t){r.exports=t()})(qe,function(){return function(s,t){t.prototype.weekday=function(a){var i=this.$locale().weekStart||0,d=this.$W,p=(d<i?d+7:d)-i;return this.$utils().u(a)?p:this.subtract(p,"day").add(a,"day")}}})})(De);var ht=De.exports;const vt=ye(ht),mt={top_legend:23e5,top_1:6e5,top_diamond:18e4,international_director:72e3,national_director:35e3,regional_director:25e3,master_2500:15e3,master_1500:12e3,master_1000:8e3,advanced_builder:6e3,star_builder:1500,initial_builder:500,none:0},gt=["initial_builder","star_builder","advanced_builder","master_1000","master_1500","master_2500","regional_director","national_director","international_director","top_diamond","top_1","top_legend"],xt={none:{display:"Ninguno",key:"none",order:-1},initial_builder:{display:"Initial Builder",key:"initial_builder",order:0},star_builder:{display:"Star Builder",key:"star_builder",order:1},advanced_builder:{display:"Advanced Builder",key:"advanced_builder",order:2},master_1000:{display:"Master 1000",key:"master_1000",order:3},master_1500:{display:"Master 1500",key:"master_1500",order:4},master_2500:{display:"Master 2500",key:"master_2500",order:5},regional_director:{display:"Regional Director",key:"regional_director",order:6},national_director:{display:"National Director",key:"national_director",order:7},international_director:{display:"International Director",key:"international_director",order:8},top_diamond:{display:"Top Diamond",key:"top_diamond",order:9},top_1:{display:"Top 1%",key:"top_1",order:10},top_legend:{display:"Top Legend",key:"top_legend",order:11}},_t=["Lunes","Martes","Miercoles","Jueves","Viernes","Sabado","Domingo"],yt={none:"Ninguno",initial_builder:"Initial Builder",star_builder:"Star Builder",advanced_builder:"Advance Builder",master_2000:"Master 2000",master_2500:"Master 2500",master_3500:"Master 3500",regional_director:"Regional Director",national_director:"National Director",international_director:"International Director",top_diamond:"TOP Diamond",top_1:"TOP 1%",top_legend:"TOP LENGEND"};se.extend(Fe);se.extend(vt);const wt=()=>{var le;const r=Be(l=>l.auth.user),[e,s]=f.useState({}),[t,a]=f.useState({}),[i,d]=f.useState(null),[p,h]=f.useState({}),[_,g]=f.useState({}),[o,b]=f.useState(!1),[ke,J]=f.useState(!0),[q,re]=f.useState(!1),[B,ae]=f.useState(!1),[ie,Pe]=f.useState([]),[oe,Oe]=f.useState([]),[Me,Ee]=f.useState(!1),[j,ze]=f.useState({right_points:0,left_points:0}),[w,Re]=f.useState({right_points:0,left_points:0});f.useEffect(()=>{e&&(X(r.uid),Le(),Ce())},[e,i,r.uid]),f.useEffect(()=>{r.uid&&(Te(r.uid),Ie(r.rank))},[r.uid]);const Ie=async l=>{J(!0);try{const u=await fetch(`https://empowerit-api.vercel.app/ranks/getRankKey/${l}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_user:r.uid})});if(!u.ok)throw new Error("Network response was not ok");const N=await u.json();a(N),J(!1)}catch(u){return J(!1),{status:"error",error:u}}};f.useEffect(()=>{if(!q&&(j.left_points||j.right_points)&&e.rank&&i){const l={title:{text:"Puntos del mes actual"},xAxis:{type:"category",data:["Izquierda","Derecha"]},yAxis:{type:"value",min:0,max:j.left_points>j.right_points?j.left_points*1.2:j.right_points*1.2},series:[{data:[j.left_points,j.right_points],type:"bar",name:"Puntos",label:{show:!0},markLine:{data:[{name:i==null?void 0:i.key,yAxis:i==null?void 0:i.points,label:{position:"middle",formatter:()=>`${i.display}`,fontWeight:"bold"}}]}}]};h(l)}},[j,q,e,t,i]),f.useEffect(()=>{if(!B&&(w.left_points||w.right_points)&&e.rank&&i){const l={title:{text:"Puntos del mes anterior"},xAxis:{type:"category",data:["Izquierda","Derecha"]},yAxis:{type:"value",min:0,max:w.left_points>w.right_points?w.left_points*1.2:w.right_points*1.2},series:[{data:[w.left_points,w.right_points],type:"bar",name:"Puntos",label:{show:!0}}]};g(l)}},[w,B,e,t,i]),f.useEffect(()=>{if(e.rank){const l=xt[gt[e.order+1]],u=mt[l==null?void 0:l.key];d({...l,points:u})}},[t,e]);const Te=async l=>{b(!0);try{if(r.is_admin){s({display:"Top Legend",key:"top_legend",next_rank:{display:"Rango sin desbloquear",key:"?",order:3},totalUSD:{totalUSD:78650,total_week:[25e3,18500,19600,15500]},user_id:r.id,user:r.id,left_week:[6,7,7,5],right_week:[6,8,7,6],interna:[80,90,89,85],externa:[145,130,128,160],firmas_directas:[12,15,14,11]}),b(!1);return}const u=await fetch(`https://empowerit-api.vercel.app/ranks/getRank/${r.uid}`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!u.ok)throw new Error("Network response was not ok");const N=await u.json();s(N),b(!1)}catch(u){return b(!1),{status:"error",error:u}}},Y=se().endOf("month");async function X(l){var P,O;const u=new Date,N=new Date(u.getFullYear(),u.getMonth(),1);re(!0);try{const D=de.fromDate(N),L=ce(U(z,`users/${l}/points`),H("created_at",">=",D),ue("created_at","desc")),C=await F(L),v=[],x=[];let y=0,m=0;for(const c of C.docs)c.data().side=="right"&&(x.push({id:c.id,...c.data()}),y+=(P=c.data())==null?void 0:P.points),c.data().side=="left"&&(v.push({id:c.id,...c.data()}),m+=(O=c.data())==null?void 0:O.points);return l==r.uid&&ze({right_points:y,left_points:m}),y>=m?m:y}catch(D){console.error("Error obteniendo documentos: ",D)}finally{re(!1)}}async function Le(){var P,O;const l=new Date,u=new Date(l.getFullYear(),l.getMonth(),1),N=new Date(l.getFullYear(),l.getMonth()-1,1);ae(!0);try{const D=de.fromDate(u),L=ce(U(z,`users/${r.uid}/points`),H("created_at","<=",D),H("created_at",">=",N),ue("created_at","desc")),C=await F(L),v=[],x=[];let y=0,m=0;for(const c of C.docs)c.data().side=="right"&&(x.push({id:c.id,...c.data()}),y+=(P=c.data())==null?void 0:P.points),c.data().side=="left"&&(v.push({id:c.id,...c.data()}),m+=(O=c.data())==null?void 0:O.points);return Re({right_points:y,left_points:m}),`Left points => ${m}, Right Points => ${y}`}catch(D){console.error("Error obteniendo documentos: ",D)}finally{ae(!1)}}async function Ce(){try{const l=await F(U(z,`users/${r.uid}/left-people`)),u=await F(U(z,`users/${r.uid}/right-people`)),N=l.docs.map(async v=>{const x=v.data(),y=fe(z,"users",x.user_id),m=await pe(y);let c="",$="";m.exists()&&(c=m.data().name,$=m.data().rank);const M=await X(v.data().user_id);return M&&M>0?{volumen:M,data:x,name:c,rank:$}:null}),P=u.docs.map(async v=>{const x=v.data(),y=fe(z,"users",x.user_id),m=await pe(y);let c="",$="";m.exists()&&(c=m.data().name,$=m.data().rank);const M=await X(x.user_id);return M&&M>0?{volumen:M,data:x,name:c,rank:$}:null}),O=await Promise.all(N),D=await Promise.all(P),L=O.filter(v=>v!==null).sort((v,x)=>x.volumen-v.volumen),C=D.filter(v=>v!==null).sort((v,x)=>x.volumen-v.volumen);Pe(L),Oe(C)}catch(l){console.error(l)}finally{Ee(!0)}}return n.jsxs("div",{className:"flex flex-col w-full h-full space-y-10",children:[n.jsxs("div",{className:"flex w-full justify-between",children:[n.jsxs("div",{children:["Corte: ",_t[Y.weekday()]," ",Y.date()," ",Y.format("MMMM")," 11:59 PM (CDMX)"]}),n.jsx("div",{children:n.jsx("a",{href:"/img/ranks/calificacion_rangos.pdf",download:"download",className:"cursor-pointer underline text-blue-400 hidden",children:"¿Guía de clasificación de rangos?"})})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-1 lg:grid-cols-4 gap-4 w-full",children:[n.jsx("div",{className:"card hover:shadow-lg transition duration-150 ease-in-out hover:dark:border-gray-400 card-border cursor-pointer user-select-none",role:"presentation",children:n.jsxs("div",{className:"flex p-4 justify-between bg-slate-100 rounded-[10px] h-full",children:[n.jsxs("div",{className:"flex flex-col",children:[n.jsx("p",{children:"Rango actual"}),ke?n.jsx(A,{className:"select-loading-indicatior",size:40}):n.jsx("p",{className:"text-[24px] font-bold",children:t==null?void 0:t.display})]}),n.jsx("div",{className:"flex flex-col justify-center",children:n.jsx("img",{src:`/img/insignias/${t==null?void 0:t.key}.png`,className:K((t==null?void 0:t.key)=="none"&&"hidden"),width:40,height:40})})]})}),n.jsx("div",{className:"card hover:shadow-lg transition duration-150 ease-in-out hover:dark:border-gray-400 card-border cursor-pointer user-select-none",role:"presentation",children:n.jsxs("div",{className:"flex p-4 justify-between bg-slate-100 rounded-[10px] h-full",children:[n.jsxs("div",{className:"flex flex-col",children:[n.jsx("p",{children:"Rango calificado para el próximo corte"}),o?n.jsx(A,{className:"select-loading-indicatior",size:40}):e.order==-1?n.jsx("p",{className:"text-[24px] font-bold",children:"Ninguno"}):n.jsx("p",{className:"text-[24px] font-bold",children:e.display})]}),n.jsx("div",{className:"flex flex-col justify-center",children:n.jsx("img",{src:`/img/insignias/${e==null?void 0:e.key}.png`,className:K(((e==null?void 0:e.key)==null||(e==null?void 0:e.key)=="none")&&"hidden"),width:40,height:40})})]})}),n.jsx("div",{className:"card hover:shadow-lg transition duration-150 ease-in-out hover:dark:border-gray-400 card-border cursor-pointer user-select-none",role:"presentation",children:n.jsxs("div",{className:"flex p-4 justify-between bg-slate-100 rounded-[10px] h-full",children:[n.jsxs("div",{className:"flex flex-col",children:[n.jsx("p",{children:"Siguiente rango al que puedes llegar"}),o?n.jsx(A,{className:"select-loading-indicatior",size:40}):e.order==-1?n.jsx("p",{className:"text-[24px] font-bold",children:"Initial Builder"}):n.jsx("p",{className:"text-[24px] font-bold",children:i==null?void 0:i.display})]}),n.jsx("div",{className:"flex flex-col justify-center",children:n.jsx("img",{src:`/img/insignias/${(le=e==null?void 0:e.next_rank)==null?void 0:le.key}.png`,className:K(((e==null?void 0:e.next_rank)==null||(e==null?void 0:e.next_rank)=="none")&&"hidden"),width:40,height:40})})]})})]}),n.jsxs("div",{className:"flex flex-col-reverse xl:flex-row",children:[n.jsxs("div",{className:"flex flex-col gap-4 w-full lg:w-[500px] lg:min-w-[450px] xl:w-[600px] h-full",children:[B&&n.jsx(A,{className:"select-loading-indicatior",size:40}),n.jsx("p",{className:"text-[24px] font-bold "+B?"":"hidden",children:n.jsx(_e,{option:_},"1")})]}),n.jsxs("div",{className:"flex flex-col gap-4 w-full lg:w-[500px] lg:min-w-[440px] xl:w-[600px] h-full",children:[q&&n.jsx(A,{className:"select-loading-indicatior",size:40}),n.jsx("p",{className:"text-[24px] font-bold "+q?"":"hidden",children:n.jsx(_e,{option:p},"2")})]})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsxs("div",{className:" w-[45%] flex flex-col",children:[n.jsx("span",{className:"text-lg font-semibold mb-5 text-center",children:"Pierna izquierda (mes actual)"}),n.jsxs(he,{children:[n.jsx(ve,{children:n.jsxs(me,{children:[n.jsx(R,{children:"Persona"}),n.jsx(R,{children:"Volumen"}),n.jsx(R,{children:"Rango"})]})}),n.jsx(ge,{children:ie&&e&&i&&t&&ie.slice(0,5).map((l,u)=>n.jsxs("tr",{children:[n.jsx("td",{children:l.name}),n.jsx("td",{children:l.volumen}),n.jsx("td",{children:l.rank})]},u))})]})]}),n.jsxs("div",{className:" w-[45%] flex flex-col",children:[n.jsx("span",{className:"text-lg font-semibold mb-5 text-center",children:"Pierna Derecha (mes actual)"}),n.jsxs(he,{children:[n.jsx(ve,{children:n.jsxs(me,{children:[n.jsx(R,{children:"Persona"}),n.jsx(R,{children:"Volumen"}),n.jsx(R,{children:"Rango"})]})}),n.jsx(ge,{children:Me&&oe&&e&&i&&t&&oe.slice(0,5).map((l,u)=>n.jsxs("tr",{children:[n.jsx("td",{children:l.name}),n.jsx("td",{children:l.volumen}),n.jsx("td",{children:yt[l.rank]})]},u))})]})]})]})]})};export{wt as default};
