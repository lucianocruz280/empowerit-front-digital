import{r as o,j as e,b as N,u as L,d as M,o as q,c as D,a as E,I as B,e as Q,f as X,B as I,g as O,h as Y,S as z,D as G,bk as H,bl as K}from"./index-dd631538.js";import{u as $}from"./index-e93e3954.js";import{S as U}from"./ShowQR-b3047f02.js";import{d as W,u as J,F as R,c as V,a as Z,g as ee,C as se,e as ae}from"./ButtonSwapCurrency-1311b5dd.js";import"./index.esm-bb4ad11f.js";function b({image:a,name:i,credits:c,display_name:n,month_price:s,binary_points:p,range_points:u,bir:d,binary_percent:l,mentor_bonus:k,cap:m,year_price:v,days_label:r="Mensual",method:h}){const[t,j]=o.useState(!1),_=$(y=>y.auth.user),[P,F]=o.useState("monthly"),w=async(y,x,g,S,C)=>{try{if(t)return;j(!0),F(g),await W(_.uid,y,x,g,S,C)}catch(A){console.error(A)}finally{j(!1)}},f=_.membership==i;return e.jsxs("div",{className:N("rounded-md w-full ring-1 flex flex-col p-4 space-y-4 transition-all duration-75 h-min",f&&"shadow-md shadow-green-700/50 ring-green-300",!f&&"ring-gray-200"),children:[e.jsx("img",{src:a,className:N("aspect-video object-contain transition-all duration-75")}),e.jsxs("div",{className:"grid grid-cols-[min-content_1fr] w-max gap-x-4 ",children:[e.jsx("span",{className:"text-left max-w-xs truncate",children:"Franquicia: "}),e.jsx("span",{className:"font-bold max-w-xs truncate",children:n}),n=="F49"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"max-w-xs truncate",children:"Incluye:"}),e.jsx("span",{className:"font-bold",children:"Posicionamiento"}),e.jsx("span",{}),e.jsx("span",{className:"font-bold",children:"Acceso a leverage"}),e.jsx("span",{}),e.jsx("span",{className:"font-bold",children:"Bono residual leverage"})]}),n!="F49"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"max-w-xs truncate",children:"Puntos de Binario:"}),e.jsxs("span",{className:"font-bold",children:[p," puntos"]})]}),n!="F3000"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-left",children:"Creditos: "}),e.jsxs("span",{className:"font-bold",children:[c," creditos"]})]}),e.jsx("span",{className:"text-left",children:"CAP: "}),e.jsxs("span",{className:"font-bold",children:[m," dolares"]}),n=="F3000"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-left",children:"Beneficios: "}),e.jsx("span",{className:"font-bold",children:"1 año Top Xpert"}),e.jsx("span",{className:"text-left"}),e.jsx("span",{className:"font-bold",children:"Cuenta leverage 5000 usd"}),e.jsx("span",{className:"text-left"}),e.jsx("span",{className:"font-bold",children:"Crucero incluido"}),e.jsx("span",{className:"text-left"}),e.jsx("span",{className:"font-bold",children:"Kit crucero lifestyle"})]}),f&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-right",children:"Estado:"}),e.jsx("span",{className:"font-bold text-green-600",children:"Activa"})]})]}),e.jsx(U,{type:i,loading:t,createPaymentLink:w,period:P,method:h,options:v?[{label:r,value:"monthly"},{label:"Anual",value:"yearly"}]:[{label:r,value:"monthly"}]})]})}const ne=({type:a,createPaymentLink:i,loading:c,openModal:n})=>{var F,w,f,y;const s=L(x=>x.auth.user),{copy:p}=Z(),[u,d]=o.useState(0),[l,k]=o.useState(!1),m=s.payment_link_participations&&s.payment_link_participations[a]&&((F=s.payment_link_participations[a])==null?void 0:F.address),v=s.payment_link_participations&&s.payment_link_participations[a]&&((w=s.payment_link_participations[a])==null?void 0:w.amount),r=s.payment_link_participations&&s.payment_link_participations[a]&&((f=s.payment_link_participations[a])==null?void 0:f.expires_at),h=s.payment_link_participations&&s.payment_link_participations[a]&&((y=s.payment_link_participations[a])==null?void 0:y.qr),t=M(r!=null&&r.seconds?(r==null?void 0:r.seconds)*1e3:null).isBefore(M()),j=async()=>{const x=Number(s.payment_link_participations[a].amount);try{const g=await ee(s.uid?s.uid:"",m||""),S=x-g,C=8,A=Math.ceil(S*Math.pow(10,C))/Math.pow(10,C);g>0&&k(!0),d(A)}catch(g){console.error("Error al calcular el monto pendiente: ",g),d(x)}};o.useEffect(()=>{if(s.uid){const x=q(D(E,`users/${s.uid}/transactions`),()=>{j()});return()=>x()}},[s.uid]),o.useEffect(()=>{m&&s.payment_link_participations&&s.payment_link_participations[a]&&d(Number(s.payment_link_participations[a].amount)||0)},[m,v]);const _=J(s.payment_link_participations&&s.payment_link_participations[a]&&s.payment_link_participations[a].expires_at&&r&&!l?r.seconds*1e3:void 0),P=async()=>{const x=O(E,`users/${s.uid}`);await Y(x,{payment_link_participations:{}})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-1 flex-col space-y-2 items-center",children:[e.jsx("span",{children:s.email}),t&&!l?null:e.jsx("div",{children:e.jsx("img",{src:h,className:N("h-[150px] w-[150px]",s.payment_link_participations[a].currency=="MXN"&&"hidden")})}),e.jsx(B,{readOnly:!0,prefix:e.jsx(Q,{}),value:t&&!l?"":m,className:N(s.payment_link_participations[a].currency=="MXN"&&"hidden"),suffix:e.jsx("div",{className:"bg-gray-200 p-2 rounded-lg hover:cursor-pointer hover:bg-gray-300",onClick:()=>p(m),children:e.jsx(R,{})})}),e.jsxs("div",{className:t||l?"grid gap-x-4 w-full":"grid grid-cols-[30%_1fr] gap-x-4 w-full",children:[t||l?null:e.jsx(B,{readOnly:!0,prefix:e.jsx(X,{}),value:_}),e.jsx(B,{readOnly:!0,prefix:V[s.payment_link_participations[a].currency||"BTC"],value:t&&!l?"":u.toFixed(8),suffix:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{children:s.payment_link_participations[a].currency})," ",e.jsx("div",{className:"bg-gray-200 p-2 rounded-lg hover:cursor-pointer hover:bg-gray-300",onClick:()=>p(u.toFixed(8)||""),children:e.jsx(R,{})})]})})]}),!t&&s.payment_link_participations[a].currency=="MXN"&&e.jsx("div",{className:"flex justify-between space-x-2 w-full py4",children:e.jsx("button",{className:"bg-green-600 rounded-md px-4 py-2 text-white text-xl hover:bg-green-800",onClick:()=>n(),children:"Pagar"})})]}),l?e.jsx("div",{children:e.jsxs("p",{className:"text-red-400 font-bold text-center",children:["Se detectó un pago",e.jsx("br",{}),"que no cubre la totalidad,",e.jsx("br",{}),"favor de pagar el resto."]})}):null,t&&!l?e.jsx("div",{children:e.jsx("p",{className:"text-red-400 font-bold text-center",children:"QR de pago caducado."})}):null,e.jsx("div",{children:e.jsxs("p",{className:"text-center",children:["Los créditos se te añadiran",e.jsx("br",{}),"despues de confirmar el pago."]})}),e.jsx("div",{children:e.jsxs("button",{className:"rounded-md px-4 py-2 underline",onClick:()=>P(),children:["<-"," Cambiar metodo de pago"]})}),t&&!l?e.jsx("div",{className:"flex justify-end space-x-1",children:e.jsx(I,{loading:c,disabled:!t,onClick:()=>i(a,s.payment_link_participations[a].currency),children:"Calcular de nuevo"})}):null,s.payment_link_participations[a]&&r&&e.jsxs("span",{className:"text-xs text-gray-300",children:["Tu membresia expiró el:"," ",M(r.seconds*1e3).format("YYYY-MM-DD HH:mm:ss")]})]})},T=({type:a,loading:i,createPaymentLink:c,founder:n})=>{o.useState("monthly");const[s,p]=o.useState(!1);o.useState(!1);const u=()=>{p(!0)};return s?e.jsx("div",{className:"flex flex-col space-y-2",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-4"})}):e.jsx("div",{children:e.jsx(I,{loading:i,onClick:u,children:"Generar QR de Pago"})})},ie=({type:a,loading:i,createPaymentLink:c})=>{const n=L(s=>s.auth.user);return n.payment_link_participations&&n.payment_link_participations[a]&&n.payment_link_participations[a].status=="pending"?e.jsx(e.Fragment,{children:e.jsx(ne,{type:a,loading:i,createPaymentLink:c,openModal:()=>{window.open(n.payment_link_participations[a].qr)}})}):n.payment_link_participations&&n.payment_link_participations[a]&&n.payment_link_participations[a].status=="confirming"?e.jsx(se,{}):n.membership_status=="paid"?e.jsx(e.Fragment,{children:e.jsx(T,{type:a,loading:i,createPaymentLink:c})}):!n.payment_link_participations||!n.payment_link_participations[a]?e.jsx(e.Fragment,{children:e.jsx(T,{type:a,loading:i,createPaymentLink:c})}):e.jsx(z,{})};function te({image:a,name:i,display_name:c,price:n,binary_points:s,range_points:p,bir:u}){const[d,l]=o.useState(!1),k=$(t=>t.auth.user),[m,v]=o.useState("monthly"),r=async(t,j)=>{try{if(d)return;l(!0),v(m),await ae(k.uid,t,j)}catch(_){console.error(_)}finally{l(!1)}},h=k.membership==i;return e.jsxs("div",{className:N("rounded-md w-full ring-1 flex flex-col p-4 space-y-4 transition-all duration-75 h-min",h&&"shadow-md shadow-green-700/50 ring-green-300",!h&&"ring-gray-200"),children:[e.jsx("img",{src:a,className:N("aspect-video object-contain transition-all duration-75")}),e.jsxs("div",{className:"grid grid-cols-[min-content_1fr] w-max gap-x-4 ",children:[e.jsx("span",{className:"text-left max-w-xs truncate",children:"Franquicia: "}),e.jsx("span",{className:"font-bold max-w-xs truncate",children:c}),e.jsx("span",{className:"max-w-xs truncate",children:"Puntos de Binario:"}),e.jsxs("span",{className:"font-bold",children:[s," puntos"]}),e.jsx("span",{className:"max-w-xs truncate",children:"Puntos de Rango:"}),e.jsxs("span",{className:"font-bold",children:[p," puntos"]}),h&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-right",children:"Estado:"}),e.jsx("span",{className:"font-bold text-green-600",children:"Activa"})]})]}),e.jsx(ie,{type:i,loading:d,createPaymentLink:r})]})}const de=()=>{const[a,i]=o.useState(null),c=L(n=>n.auth.user);return console.log(c),o.useEffect(()=>{if(new URL(window.location.href).searchParams.has("transaction")){i("pending"),console.log("esperando respuesta de openpay");const s=q(O(E,`users/${c.uid}`),p=>{const u=p.get("payment_link"),d=Object.keys(u)[0];p.get(`payment_link.${d}.status`)!="pending"&&(i(p.get(`payment_link.${d}.status`)),s())});return()=>{s()}}},[]),e.jsxs("div",{className:"flex flex-col gap-4 h-full",children:[e.jsxs(G,{isOpen:a!==null,onClose:()=>{a!=="pending"&&i(null)},children:[a=="pending"&&e.jsx("div",{children:e.jsx("span",{className:"text-blue-500",children:"Confirmando tu transacción, espere..."})}),a=="success"&&e.jsxs("div",{className:"text-green-500 flex items-center space-x-4",children:[e.jsx(H,{size:24}),e.jsx("span",{children:"Transacción completada con éxito"})]}),a=="failed"&&e.jsxs("div",{className:"text-red-500 flex items-center space-x-4",children:[e.jsx(K,{size:24}),e.jsx("span",{children:"Transacción rechazada"})]})]}),e.jsx("div",{className:"flex items-center space-x-4",children:e.jsx("span",{className:"font-bold text-3xl",children:"Franquicias Manuales"})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 3xl:grid-cols-3 4xl:grid-cols-4 gap-y-2 gap-x-4",children:[e.jsx(b,{image:"/img/Franchises/100-pack.png",name:"100-pack",display_name:"F100",month_price:100,binary_points:50,range_points:100,bir:15,binary_percent:10,mentor_bonus:10,cap:300,credits:100}),e.jsx(b,{image:"/img/Franchises/300-pack.png",name:"300-pack",display_name:"F300",month_price:300,binary_points:150,range_points:300,bir:15,binary_percent:10,mentor_bonus:15,cap:1e3,credits:300}),e.jsx(b,{image:"/img/Franchises/500-pack.png",name:"500-pack",display_name:"F500",month_price:500,binary_points:250,range_points:500,bir:20,binary_percent:10,mentor_bonus:15,cap:2e3,credits:500}),e.jsx(b,{image:"/img/Franchises/1000-pack.png",name:"1000-pack",display_name:"F1000",month_price:1e3,binary_points:500,range_points:1e3,bir:20,binary_percent:15,mentor_bonus:15,cap:5e3,credits:1e3}),e.jsx(b,{image:"/img/Franchises/2000-pack.png",name:"2000-pack",display_name:"F2000",month_price:2e3,binary_points:1e3,range_points:2e3,bir:20,binary_percent:15,mentor_bonus:20,cap:1e4,credits:2e3}),e.jsx(b,{image:"/img/Franchises/3000-pack.png",name:"3000-pack",display_name:"F3000",month_price:3e3,binary_points:300,range_points:1e3,bir:20,binary_percent:15,mentor_bonus:20,cap:15e3,credits:0})]}),e.jsx("div",{className:"flex items-center space-x-4",children:e.jsx("span",{className:"font-bold text-3xl",children:"PARTICIPACIONES"})}),e.jsx("div",{className:"grid grid-cols-1 xl:grid-cols-2 3xl:grid-cols-3 4xl:grid-cols-4 gap-y-2 gap-x-4",children:e.jsx(te,{image:"/img/memberships/p300.png",name:"3000-participation",display_name:"Participación 3000",price:3e3,binary_points:300,range_points:1e3,bir:5})})]})};export{de as default};
