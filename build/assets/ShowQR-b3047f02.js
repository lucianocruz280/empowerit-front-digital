import{r as p,u as w,j as e,B as C,d as f,o as q,c as I,a as B,b as R,I as v,e as O,f as $,g as G,h as H,S as U}from"./index-dd631538.js";import{u as W,F as E,c as z,a as J,g as K,C as V}from"./ButtonSwapCurrency-1311b5dd.js";const N=({type:n,loading:i,createPaymentLink:l,options:h,founder:_})=>{const[c,g]=p.useState("monthly"),[s,o]=p.useState(!1),[u,x]=p.useState(!1),a=w(j=>j.auth.user),y=(j,r)=>{try{x(!0),l(n,j,c,r,a.email)}catch(b){console.error(b)}finally{}},d=()=>{o(!0)};return s?e.jsx("div",{className:"flex flex-col space-y-2",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-4",children:n!="3000-pack"&&e.jsx(C,{className:"h-max",disabled:u,onClick:()=>y("MXN","Coinpayments"),children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("img",{src:"/img/insignias/USDT.svg",className:"w-[50px] h-[50px]"}),e.jsx("span",{children:"Tether (USDT)"})]})})})}):e.jsx("div",{children:e.jsx(C,{loading:i,onClick:d,children:"Generar QR de Pago"})})},Z=({type:n,createPaymentLink:i,loading:l,period:h,founder:_,openModal:c,method:g})=>{var S,F,M,D;const s=w(m=>m.auth.user),{copy:o}=J(),[u,x]=p.useState(0),[a,y]=p.useState(!1),d=s.payment_link&&s.payment_link[n]&&((S=s.payment_link[n])==null?void 0:S.address),j=s.payment_link&&s.payment_link[n]&&((F=s.payment_link[n])==null?void 0:F.amount),r=s.payment_link&&s.payment_link[n]&&((M=s.payment_link[n])==null?void 0:M.expires_at),b=s.payment_link&&s.payment_link[n]&&((D=s.payment_link[n])==null?void 0:D.qrcode_url),t=f(r!=null&&r.seconds?(r==null?void 0:r.seconds)*1e3:null).isBefore(f()),T=async()=>{const m=Number(s.payment_link[n].amount);try{const k=await K(s.uid?s.uid:"",d||""),X=m-k,A=8,Y=Math.ceil(X*Math.pow(10,A))/Math.pow(10,A);k>0&&y(!0),x(Y)}catch(k){console.error("Error al calcular el monto pendiente: ",k),x(m)}};p.useEffect(()=>{if(s.uid){const m=q(I(B,`users/${s.uid}/transactions`),()=>{T()});return()=>m()}},[s.uid]),p.useEffect(()=>{d&&s.payment_link&&s.payment_link[n]&&x(Number(s.payment_link[n].amount)||0)},[d,j]);const Q=W(s.payment_link&&s.payment_link[n]&&s.payment_link[n].expires_at&&r&&!a?r.seconds*1e3:void 0),P=async()=>{const m=G(B,`users/${s.uid}`);await H(m,{payment_link:{}})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-1 flex-col space-y-2 items-center",children:[e.jsx("span",{children:s.email}),t&&!a?null:e.jsx("div",{children:e.jsx("img",{src:b,className:R("h-[150px] w-[150px]",s.payment_link[n].currency=="MXN"&&"hidden")})}),e.jsx(v,{readOnly:!0,prefix:e.jsx(O,{}),value:t&&!a?"":d,className:R(s.payment_link[n].currency=="MXN"&&"hidden"),suffix:e.jsx("div",{className:"bg-gray-200 p-2 rounded-lg hover:cursor-pointer hover:bg-gray-300",onClick:()=>o(d),children:e.jsx(E,{})})}),e.jsxs("div",{className:t||a?"grid gap-x-4 w-full":"grid grid-cols-[30%_1fr] gap-x-4 w-full",children:[t||a?null:e.jsx(v,{readOnly:!0,prefix:e.jsx($,{}),value:Q}),e.jsx(v,{readOnly:!0,prefix:z[s.payment_link[n].currency||"BTC"],value:t&&!a?"":u.toFixed(8),suffix:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{children:s.payment_link[n].currency})," ",e.jsx("div",{className:"bg-gray-200 p-2 rounded-lg hover:cursor-pointer hover:bg-gray-300",onClick:()=>o(u.toFixed(8)||""),children:e.jsx(E,{})})]})})]}),!t&&s.payment_link[n].currency=="MXN"&&e.jsx(e.Fragment,{children:e.jsx("button",{className:"bg-green-600 rounded-md px-4 py-2 text-white text-xl hover:bg-green-800",onClick:()=>c(),children:"Pagar"})})]}),a?e.jsx("div",{children:e.jsxs("p",{className:"text-red-400 font-bold text-center",children:["Se detectó un pago",e.jsx("br",{}),"que no cubre la totalidad,",e.jsx("br",{}),"favor de pagar el resto."]})}):null,t&&!a?e.jsx("div",{children:e.jsx("p",{className:"text-red-400 font-bold text-center",children:"QR de pago caducado."})}):null,e.jsxs("div",{children:[e.jsxs("p",{className:"text-center",children:["La membresia se activará automaticamente",e.jsx("br",{}),"despues de confirmar el pago."]}),e.jsxs("button",{className:"rounded-md px-4 py-2 underline",onClick:()=>P(),children:["<-"," Cambiar metodo de pago"]})]}),t&&!a?e.jsx("div",{className:"flex justify-end space-x-1",children:e.jsx(C,{loading:l,disabled:!t,onClick:()=>i(n,s.payment_link[n].currency,h,g,s.email),children:"Calcular de nuevo"})}):null,s.payment_link[n]&&r&&e.jsxs("span",{className:"text-xs text-gray-300",children:["Tu membresia expiró el:"," ",f(r.seconds*1e3).format("YYYY-MM-DD HH:mm:ss")]})]})},L=({type:n,loading:i,createPaymentLink:l,options:h,period:_,founder:c,method:g})=>{const s=w(a=>a.auth.user),o=s==null?void 0:s.membership_expires_at,u=o?f(o):null,x=f().add(1,"days");return o&&u&&u.isBefore(x.toDate())&&!s.payment_link||c&&!s.founder_pack&&!s.payment_link?e.jsx(e.Fragment,{children:e.jsx(N,{type:n,loading:i,createPaymentLink:l,options:h,founder:c})}):s.payment_link&&s.payment_link[n]&&s.payment_link[n].status=="pending"?e.jsx(e.Fragment,{children:e.jsx(Z,{type:n,loading:i,createPaymentLink:l,period:_,openModal:()=>{window.open(s.payment_link[n].redirect_url)},method:g})}):s.payment_link&&s.payment_link[n]&&s.payment_link[n].status=="confirming"?e.jsx(V,{}):s.membership_status=="paid"?e.jsx(e.Fragment,{children:e.jsx(N,{type:n,loading:i,createPaymentLink:l,options:h,founder:c})}):!s.payment_link||!s.payment_link[n]?e.jsx(e.Fragment,{children:e.jsx(N,{type:n,loading:i,createPaymentLink:l,options:h,founder:c})}):e.jsx(U,{})},ne=L;export{ne as S};
