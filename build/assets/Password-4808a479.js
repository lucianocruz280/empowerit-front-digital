import{r as d,u as A,j as e,b4 as E,I as u,cN as I,B as m,cI as V,cO as k,cP as q,cQ as z,b0 as c,b1 as i}from"./index-dd631538.js";import{F as $,a as p}from"./FormRow-59e55473.js";import{F as L,a as O,b as h}from"./formik.esm-56d92394.js";import{c as R,a as w,e as T}from"./index.esm-65d2e63a.js";import{g as B,c as D,s as H,v as M,d as Q}from"./emailSender-300b5ebe.js";const U=R().shape({password:w().required("Contraseña requerida"),newPassword:w().required("Ingresa tu nueva contraseña").min(8,"Muy corta!").matches(/^[A-Za-z0-9_-]*$/,"Sólo letras y números permitidos"),confirmNewPassword:w().oneOf([T("newPassword"),void 0],"La contraseña no coincide")}),K=()=>{const[s,g]=d.useState(!1),[f,j]=d.useState(!1),[y,v]=d.useState(""),[b,x]=d.useState(!1),C=A(t=>t.auth.user),P=async(t,o)=>{if(!s)return!1;const a=V.currentUser||null;if(a){const r=k.credential(a.email||"",t.password);q(a,r).then(()=>{z(a,t.newPassword).then(()=>{c.push(e.jsx(i,{title:"Contraseña actualizada",type:"success"}),{placement:"top-center"})}).catch(n=>{console.log(n),c.push(e.jsx(i,{title:"Error",type:"danger"}),{placement:"top-center"})})}).catch(n=>{c.push(e.jsx(i,{title:`Error durante la reautenticación: ${n}`,type:"danger"}),{placement:"top-center"}),console.log("Error durante la reautenticación:",n)})}else console.error("No se ha encontrado un usuario autenticado.");o(!1)},N=(t,o)=>{x(!0);const a=B();D(t,a).then(r=>{r&&H(o,a).then(()=>{j(!0),x(!1),c.push(e.jsx(i,{title:"Se envio un codigo de verificacion a tu correo",type:"success"}),{placement:"top-center"})})}).catch(r=>{x(!1),console.log(r)})},F=(t,o)=>{M(t,o).then(a=>{c.push(e.jsx(i,{title:a?"Codigo valido":"Codigo invalido",type:a?"success":"danger"}),{placement:"top-center"}),a&&(j(!1),g(!0),Q(t))}).catch(a=>{console.log(a)})};return e.jsx(e.Fragment,{children:e.jsx(L,{initialValues:{password:"",newPassword:"",confirmNewPassword:""},validationSchema:U,onSubmit:(t,{setSubmitting:o})=>{o(!0),setTimeout(()=>{P(t,o)},1e3)},children:({values:t,touched:o,errors:a,isSubmitting:r,resetForm:n})=>{const l={touched:o,errors:a};return e.jsx(O,{children:e.jsxs(E,{children:[e.jsx($,{title:"Contraseña",desc:"Ingresa tu contraseña actual y tu nueva contraseña para actualizarla"}),e.jsx(p,{name:"password",label:"Contraseña actual",...l,children:e.jsx(h,{type:"password",autoComplete:"off",name:"password",placeholder:"Contraseña actual",component:u,readonly:!s,disabled:!s})}),e.jsx(p,{name:"newPassword",label:"Nueva contraseña",...l,children:e.jsx(h,{type:"password",autoComplete:"off",name:"newPassword",placeholder:"Nueva contraseña",component:u,readonly:!s,disabled:!s})}),e.jsx(p,{name:"confirmNewPassword",label:"Confirmar nueva contraseña",...l,children:e.jsx(h,{type:"password",autoComplete:"off",name:"confirmNewPassword",placeholder:"Confirmar nueva contraseña",component:u,readonly:!s,disabled:!s})}),f&&e.jsxs(p,{name:"code",label:"Codigo",...l,children:[e.jsx(h,{type:"text",autoComplete:"off",name:"code",placeholder:"Codigo de verificación",component:u,prefix:e.jsx(I,{className:"text-xl"}),onChange:S=>{v(S.currentTarget.value)}}),e.jsx(m,{className:"mt-2 ltr:mr-2 rtl:ml-2 ",type:"button",variant:"default",color:"primary",onClick:()=>F(C.uid,y),children:"Verificar"})]}),e.jsxs("div",{className:"mt-4 ltr:text-right",children:[e.jsx(m,{className:"ltr:mr-2 rtl:ml-2",type:"button",onClick:n,children:"Cancelar"}),e.jsx(m,{variant:"solid",loading:r,type:"submit",hidden:!s,children:r?"Actualizando":"Actualizar Contraseña"}),e.jsx(m,{className:"mt-2 ltr:mr-2 rtl:ml-2",type:"button",variant:"solid",hidden:s||f,disabled:f||s,loading:b,onClick:()=>N(C.uid,C.email||""),children:"Desbloquear"})]})]})})}})})};export{K as default};
