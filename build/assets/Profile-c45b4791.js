import{u as de,r as d,cq as ue,cr as xe,i as fe,j as e,aT as he,aU as be,c as ye,a as je,aX as Ce,b0 as h,b1 as b,b2 as ge,b3 as ve,aH as Ne,b4 as Se,I as n,b5 as L,b6 as Oe,b7 as we,b8 as T,b9 as Ve,ba as Fe,bb as Ee,cM as Re,B as y,cN as z,cs as ke,Z as Be,$ as Ue,ct as Ae,cu as Pe,cv as De}from"./index-dd631538.js";import{F as Ie,a as u}from"./FormRow-59e55473.js";import{F as qe,a as _e,b as o}from"./formik.esm-56d92394.js";import{c as He,a as C,d as Le}from"./index.esm-65d2e63a.js";import{g as $,c as M,s as W,v as Z,d as G}from"./emailSender-300b5ebe.js";import{u as Te,a as ze,b as $e}from"./useCities-69ee90b0.js";import{d as Me}from"./index.esm-380fcd9f.js";import{v as We}from"./v4-4a60fe23.js";const Ze=He().shape({name:C().required("User Name Required"),email:C().email("Invalid email").required("Email Required"),title:C(),avatar:C(),lang:C(),timeZone:C(),syncData:Le()}),st=({data:s})=>{var _;const X=de(a=>a.auth.user),J=d.useRef(We()),E=ue(xe,"profile-images/"+J.current),K=fe(),R=(a,r,l)=>{a.setFieldValue("avatar",l[0]),a.setFieldValue("avatarPreview",URL.createObjectURL(l[0]))},Q=(a,r)=>{h.push(e.jsx(b,{title:"Perfil actualizado",type:"success"}),{placement:"top-center"}),r(!1)},Y=async a=>(await Pe(E,a),await De(E)),[g,k]=d.useState(!1),[x,B]=d.useState(!1),[ee,N]=d.useState(!1),[j,U]=d.useState(!0),[A,P]=d.useState(""),[t,te]=d.useState(!1),ae=(a,r)=>{N(!0);const l=$();M(a,l).then(p=>{p&&W(r,l).then(()=>{k(!0),N(!1),h.push(e.jsx(b,{title:"Se envió un código de verificación a tu correo",type:"success"}),{placement:"top-center"})})}).catch(p=>{N(!1),console.log(p)})},le=(a,r)=>{Z(a,r).then(l=>{h.push(e.jsx(b,{title:l?"Código valido":"Código invalido",type:l?"success":"danger"}),{placement:"top-center"}),l&&(k(!1),te(!0),G(a))}).catch(l=>{console.log(l)})},se=(a,r)=>{const l=$();M(a,l).then(p=>{p&&W(r,l).then(()=>{B(!0),h.push(e.jsx(b,{title:"Se envió un código de verificación a tu correo",type:"success"}),{placement:"top-center"})})}).catch(p=>{console.log(p)})},oe=(a,r)=>{Z(a,r).then(l=>{h.push(e.jsx(b,{title:l?"Código valido":"Código invalido",type:l?"success":"danger"}),{placement:"top-center"}),l&&(U(!0),B(!1),G(a))}).catch(l=>{console.log(l)})},D={label:"",value:""},[S,I]=d.useState(null),[O,w]=d.useState(null),[Ge,q]=d.useState(null),re=Te(),ne=ze(S??D);$e(O??D);const ie=a=>{var r,l;(r=a==null?void 0:a.country)!=null&&r.value&&!S&&I(a.country),(l=a==null?void 0:a.state)!=null&&l.value&&!O&&w(a.state)};return d.useEffect(()=>{ie(s)},[s]),e.jsx(qe,{initialValues:{...s,city:(_=s==null?void 0:s.city)==null?void 0:_.label,avatarPreview:s.avatar},enableReinitialize:!0,validationSchema:Ze,onSubmit:async(a,{setSubmitting:r})=>{if(!t||!j||x||g)return!1;r(!0);try{const{birthdate:l,whatsapp:p,telegram:V,instagram:c,avatar:m,email:i,name:v,presenter_code:f}=a,ce={birthdate:l||""},me={whatsapp:p||"",telegram:V||"",instagram:(c==null?void 0:c.trim())||""},H={...ce,...me,presenter_code:f,email:i==null?void 0:i.trim(),name:v==null?void 0:v.trim()};let F="";if(f!=s.presenter_code&&(await he(be(ye(je,"users"),Ce("presenter_code","==",f)))).docs.filter(pe=>pe.id!=X.uid).length>0){h.push(e.jsx(b,{title:"Código de presentador no disponible",type:"danger"}),{placement:"top-center"});return}typeof m=="object"&&(F=await Y(m),H.avatar=F),(i==null?void 0:i.trim())!=s.email&&await ge(i==null?void 0:i.trim()),await ve(a.uid,H),K(Ne({...a,city:{label:a.city||"",value:a.city||""},avatar:typeof a.avatar=="object"?F:a.avatar})),setTimeout(()=>{Q(a,r)},1e3)}catch(l){console.log(l),h.push(e.jsx(b,{title:"Ha ocurrio un error",type:"danger"}),{placement:"top-center"})}},children:({values:a,touched:r,errors:l,isSubmitting:p,resetForm:V})=>{const c={touched:r,errors:l};return e.jsx(_e,{children:e.jsxs(Se,{children:[e.jsx(Ie,{title:"Información",desc:"Información básica, como tu nombre y correo que será mostrada en tu perfil"}),e.jsxs(u,{name:"name",label:"Datos Básicos",...c,children:[e.jsx(o,{type:"text",autoComplete:"off",name:"name",placeholder:"Nombre",component:n,prefix:e.jsx(L,{className:"text-xl"}),readOnly:!t,disabled:!t}),e.jsx(o,{className:"mt-2 ltr:mr-2 rtl:ml-2",type:"date",autoComplete:"off",name:"birthdate",placeholder:"Fecha de nacimiento",component:n,readOnly:!t,disabled:!t,prefix:e.jsx(Oe,{className:"text-xl"})}),e.jsx("br",{}),e.jsx("label",{children:"Código de presentador"}),e.jsx(o,{type:"text",autoComplete:"off",name:"presenter_code",placeholder:"Código de presentador",component:n,prefix:e.jsx(L,{className:"text-xl"}),readOnly:!t,disabled:!t})]}),e.jsxs(u,{name:"payroll",label:"Métodos de pago",...c,children:[e.jsx(o,{type:"text",autoComplete:"off",name:"rfc",placeholder:"RFC",component:n,readOnly:!t,disabled:!t,prefix:e.jsx(Me,{className:"text-xl"})}),e.jsx(o,{className:"mt-2 ltr:mr-2 rtl:ml-2",type:"text",autoComplete:"off",name:"bank_account",placeholder:"CLABE Cuenta de Banco",component:n,readOnly:!t,disabled:!t,prefix:e.jsx(we,{className:"text-xl"})})]}),e.jsxs(u,{name:"location",label:"Locación",...c,children:[e.jsx(o,{className:"mt-2 ltr:mr-2 rtl:ml-2",name:"country",placeholder:"País",component:T,value:S,options:re[0],isDisabled:!t,onChange:m=>{I(m),w(null),q(null)}}),e.jsx(o,{className:"mt-2 ltr:mr-2 rtl:ml-2",name:"state",placeholder:"Estado",options:ne[0],value:O,component:T,isDisabled:!t,onChange:m=>{w(m),q(null)}}),e.jsx(o,{className:"mt-2 ltr:mr-2 rtl:ml-2",type:"text",autoComplete:"off",name:"city",placeholder:"",component:n,readOnly:!t,disabled:!t}),e.jsx("br",{}),e.jsx("label",{children:"Código postal"}),e.jsx(o,{className:"mt-2 ltr:mr-2 rtl:ml-2",type:"text",autoComplete:"off",name:"cp",placeholder:"",component:n,readOnly:!t,disabled:!t}),e.jsx("label",{children:"Colonia"}),e.jsx(o,{className:"mt-2 ltr:mr-2 rtl:ml-2",type:"text",autoComplete:"off",name:"colony",placeholder:"Colonia",component:n,readOnly:!t,disabled:!t}),e.jsx("label",{children:"Calle"}),e.jsx(o,{className:"mt-2 ltr:mr-2 rtl:ml-2",type:"text",autoComplete:"off",name:"street",placeholder:"Calle",component:n,readOnly:!t,disabled:!t}),e.jsx("label",{children:"Número interior"}),e.jsx(o,{className:"mt-2 ltr:mr-2 rtl:ml-2",type:"text",autoComplete:"off",name:"num_int",placeholder:"",component:n,readOnly:!t,disabled:!t}),e.jsx("label",{children:"Número exterior"}),e.jsx(o,{className:"mt-2 ltr:mr-2 rtl:ml-2",type:"text",autoComplete:"off",name:"num_ext",placeholder:"",component:n,readOnly:!t,disabled:!t}),e.jsx("label",{children:"Referencia"}),e.jsx(o,{className:"mt-2 ltr:mr-2 rtl:ml-2",type:"text",autoComplete:"off",name:"reference",placeholder:"",component:n,readOnly:!t,disabled:!t})]}),e.jsxs(u,{name:"contact",label:"Contacto",...c,children:[e.jsx(o,{type:"number",autoComplete:"off",name:"whatsapp",placeholder:"Whatsapp",component:n,readOnly:!t,disabled:!t,prefix:e.jsx(Ve,{className:"text-xl"})}),e.jsx(o,{className:"mt-2 ltr:mr-2 rtl:ml-2",type:"text",autoComplete:"off",name:"instagram",placeholder:"Instagram",component:n,readOnly:!t,disabled:!t,prefix:e.jsx(Fe,{className:"text-xl"})}),e.jsx(o,{className:"mt-2 ltr:mr-2 rtl:ml-2",type:"number",autoComplete:"off",name:"telegram",placeholder:"Telegram",component:n,readOnly:!t,disabled:!t,prefix:e.jsx(Ee,{className:"text-xl"})})]}),e.jsxs(u,{name:"email",label:"Email",...c,children:[e.jsx(o,{type:"email",autoComplete:"off",name:"email",placeholder:"Email",component:n,prefix:e.jsx(Re,{className:"text-xl"}),readOnly:!t||j||x,disabled:!t||j||x}),e.jsx(y,{className:"mt-2 ltr:mr-2 rtl:ml-2",type:"button",variant:"default",color:"primary",hidden:!t||!j,onClick:()=>{U(!1)},children:"Cambiar"}),e.jsx(y,{className:"mt-2 ltr:mr-2 rtl:ml-2",type:"button",variant:"default",color:"primary",hidden:!t||j,disabled:x,onClick:()=>{se(s==null?void 0:s.uid,a.email)},children:"Validar"})]}),x&&e.jsxs(u,{name:"code",label:"Código",...c,children:[e.jsx(o,{type:"text",autoComplete:"off",name:"code",placeholder:"Código de verificación",component:n,prefix:e.jsx(z,{className:"text-xl"}),onChange:m=>{P(m.currentTarget.value)}}),e.jsx(y,{className:"mt-2 ltr:mr-2 rtl:ml-2 ",type:"button",variant:"default",color:"primary",onClick:()=>oe(s==null?void 0:s.uid,A),children:"Verificar"})]}),e.jsx(u,{name:"avatar",label:"Avatar",...c,children:e.jsx(o,{name:"avatar",children:({field:m,form:i})=>{const v=i.values.avatarPreview?{src:i.values.avatarPreview}:{};return e.jsx(ke,{className:t?"cursor-pointer":"cursor-not-allowed",onChange:f=>R(i,m,f),onFileRemove:f=>R(i,m,f),showList:!1,uploadLimit:1,disabled:!t,children:e.jsx(Be,{className:"border-2 border-white dark:border-gray-800 shadow-lg",size:60,shape:"circle",icon:e.jsx(Ue,{}),...v})})}})}),e.jsx(u,{name:"sponsor",label:"Patrocinador",...c,children:e.jsx(o,{type:"text",autoComplete:"off",name:"sponsor",placeholder:"Sponsor",component:n,prefix:e.jsx(Ae,{className:"text-xl"}),readOnly:!0,disabled:!0})}),g&&e.jsxs(u,{name:"code",label:"Código",...c,children:[e.jsx(o,{type:"text",autoComplete:"off",name:"code",placeholder:"Código de verificación",component:n,prefix:e.jsx(z,{className:"text-xl"}),onChange:m=>{P(m.currentTarget.value)}}),e.jsx(y,{className:"mt-2 ltr:mr-2 rtl:ml-2 ",type:"button",variant:"default",color:"primary",onClick:()=>le(s==null?void 0:s.uid,A),children:"Verificar"})]}),e.jsxs("div",{className:"mt-4 ltr:text-right",children:[e.jsx(y,{className:"ltr:mr-2 rtl:ml-2",type:"button",onClick:()=>V,children:"Cancelar"}),e.jsx(y,{variant:"solid",loading:p,type:"submit",hidden:g||x||!t||!j,children:p?"Actualizando":"Actualizar"}),e.jsx(y,{className:"mt-2 ltr:mr-2 rtl:ml-2",type:"button",variant:"solid",hidden:g||x||t,disabled:g,loading:ee,onClick:()=>ae(s==null?void 0:s.uid,s==null?void 0:s.email),children:"Desbloquear"})]})]})})}})};export{st as default};
