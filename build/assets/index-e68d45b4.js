import{u as T,r as l,c as $,a as f,aU as L,aW as H,aT as z,j as e,D as W,bq as U,br as G,bs as B,bt as k,bu as Q,bv as E,B as D,aZ as V,a_ as Z,aD as F,g as C,bj as K,bM as q,bN as X,bO as Y,h as M,I as N,b0 as ee,b1 as se,aS as te,bi as ae,bP as O,bQ as re}from"./index-dd631538.js";import{f as A}from"./format-e6b86736.js";import{p as ie}from"./products-96d808d1.js";function ne(){const h=T(r=>r.auth.user),[d,t]=l.useState(),[s,b]=l.useState(null);l.useEffect(()=>{h&&h.uid&&x(h.uid)},[]);const x=async r=>{const o=$(f,"users",r,"pending-ships"),u=L(o,H("created_at","desc")),m=await z(u);let v=[];for(const g of m.docs)v.push(g.data());t(v)},n=r=>{r.json&&b({...r,json:JSON.parse(r.json)})};return console.log(d),e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{isOpen:s!==null,onClose:()=>b(null),children:e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"flex-1",children:["Estado: ",s==null?void 0:s.address.state,e.jsx("br",{}),"Ciudad: ",s==null?void 0:s.address.city,e.jsx("br",{}),"Colonia: ",s==null?void 0:s.address.colony,e.jsx("br",{}),"Calle: ",s==null?void 0:s.address.street,e.jsx("br",{}),"CP: ",s==null?void 0:s.address.cp,e.jsx("br",{}),"Referencia: ",s==null?void 0:s.address.reference,e.jsx("br",{}),"num exterior: ",s==null?void 0:s.address.num_ext,e.jsx("br",{}),"num interior: ",s==null?void 0:s.address.num_int,e.jsx("br",{}),"Télefono: ",s==null?void 0:s.address.phone,e.jsx("br",{})]}),e.jsx("div",{className:"pr-8",children:e.jsx("ul",{children:s==null?void 0:s.json.filter(r=>r.quantity).map(r=>e.jsxs("li",{children:[r.quantity," x ",r.name]},r.id))})})]})}),e.jsx("p",{className:"font-bold text-3xl",children:"Historial de Compras"}),e.jsxs(U,{children:[e.jsx(G,{children:e.jsxs(B,{children:[e.jsx(k,{children:"Estado"}),e.jsx(k,{children:"Ciudad"}),e.jsx(k,{children:"Domicilio"}),e.jsx(k,{children:"Teléfono"}),e.jsx(k,{children:"Productos"}),e.jsx(k,{children:"Enviado"}),e.jsx(k,{children:"Guia"})]})}),e.jsx(Q,{children:d&&d.map((r,o)=>{var u,m,v,g,p,a;return e.jsxs(B,{children:[e.jsx(E,{children:(u=r.cart)==null?void 0:u.address.state}),e.jsx(E,{children:(m=r.cart)==null?void 0:m.address.city}),e.jsxs(E,{children:[(v=r.cart)==null?void 0:v.address.street,", ",(g=r.cart)==null?void 0:g.address.colony,", ",(p=r.cart)==null?void 0:p.address.num_int]}),e.jsx(E,{children:(a=r.cart)==null?void 0:a.address.phone}),e.jsx(E,{children:e.jsx(D,{size:"sm",onClick:()=>n(r==null?void 0:r.cart),children:"Ver detalles"})}),e.jsx(E,{children:(r==null?void 0:r.sent)==!0?e.jsx(V,{className:"text-green-400"}):e.jsx(Z,{className:"text-red-400"})}),e.jsx(E,{children:r==null?void 0:r.guide})]},o)})})]})]})}const le=h=>{const d=T(a=>a.auth.user),[t,s]=l.useState(!1),[b,x]=l.useState(!1),[n,r]=l.useState(ie.map(a=>({id:a.id,product_galleries:[a.product_galleries[0]],name:a.name,sale_price:a.sale_price,price:a.price,quantity:0}))),o=(a,i)=>{i<0||r(_=>{const S=[..._],j=S.findIndex(R=>R.id==a);return j>-1&&(a===9432090476817&&(i==4?i=0:i==1&&(i=5)),S[j].quantity=i,(a===94320904768178||a===943209047681782)&&x(i>0)),S})};l.useEffect(()=>{n.some(i=>(i.id===94320904768178||i.id===943209047681782)&&i.quantity>0)&&x(!0)},[n]),l.useEffect(()=>{u()},[]),l.useEffect(()=>{if(g()>Number(d.credits))s(!0);else{if(p==0){s(!0);return}s(!1)}},[n]);const u=async()=>{const a=await F(C(f,`users/${d.uid}/cart/1`));if(a.exists())try{const i=JSON.parse(a.get("json"));r(n.map(_=>({..._,quantity:i.find(S=>S.id==_.id).quantity})))}catch(i){console.error(i)}else await K(C(f,`users/${d.uid}/cart/1`),{created_at:new Date,json:JSON.stringify(n)})},m=async()=>{await M(C(f,`users/${d.uid}/cart/1`),{updated_at:new Date,json:JSON.stringify(n)}),h.onComplete()},v=()=>{if(g(),g()<=Number(d.credits))m();else return!1},g=()=>{let a=0;n.filter(j=>j.quantity).forEach(j=>{a+=Math.ceil(j.sale_price/17)*j.quantity});let i=12;return n.some(j=>(j.id===94320904768178||j.id===943209047681782)&&j.quantity>0)?i=0:p>=22?i=36:p>=10&&(i=18),a+i},p=n.reduce((a,i)=>a+i.quantity,0);return e.jsxs("div",{children:[e.jsx("img",{src:"/img/empoweritup.png",className:"w-[400px]"}),e.jsxs("p",{className:"flex font-bold text-lg my-2",children:["Créditos utilizados en el mes:"," ",e.jsxs("span",{className:"ml-1 font-normal",children:[" ",d.credits_spent_this_month," créditos"]})]}),e.jsx("p",{className:"text-lg mb-2",children:"Se activa “marketplace bono distribuidor” al realizar compras dentro del mes de más de 100 créditos"}),e.jsx("p",{className:"text-lg italic mb-2",children:"Arma tu carrito y pagalo a precio preferencial"}),e.jsx("div",{className:"grid grid-cols-1  lg:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-x-4 gap-y-4",children:n.map(a=>e.jsxs("div",{className:"bg-gray-100 flex flex-col items-center rounded-lg px-4 pb-4",children:[e.jsx("img",{src:a.product_galleries[0].original_url,className:"w-[80%] flex-1 object-contain"}),e.jsx("div",{className:"flex justify-start w-full text-lg",children:e.jsx("span",{className:"font-bold",children:a.name})}),e.jsxs("div",{className:"flex justify-start w-full space-x-2",children:[e.jsxs("span",{className:"font-medium",children:[Math.ceil(a.sale_price/17)," créditos"]}),e.jsxs("span",{className:"line-through text-gray-400",children:[Math.ceil(Number(a.price)/17)," créditos"]})]}),a.id&&a.id==9432090476817&&e.jsx("div",{className:"flex justify-start w-full space-x-2",children:e.jsx("span",{children:"Minimo de compra: 5 unidades"})}),e.jsxs("div",{className:"flex justify-start items-center w-full pb-4 space-x-2",children:[e.jsxs("div",{className:"flex justify-start text-yellow-500 space-x-1",children:[e.jsx(q,{}),e.jsx(q,{}),e.jsx(q,{}),e.jsx(q,{}),e.jsx(q,{})]}),e.jsx("div",{children:e.jsx("span",{className:"font-medium",children:"En existencia"})})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("button",{disabled:!a.quantity,className:"rounded-full bg-black text-white p-2 text-lg hover:bg-slate-800 disabled:bg-gray-400 disabled:cursor-not-allowed",onClick:()=>o(a.id,a.quantity-1),children:e.jsx(X,{})}),e.jsx("input",{value:a.quantity,className:"flex-1 rounded-full text-black bg-gray-300 h-full text-center",disabled:!0}),e.jsx("button",{className:"rounded-full bg-black text-white p-2 text-lg hover:bg-slate-700",onClick:()=>o(a.id,a.quantity+1),children:e.jsx(Y,{})})]})]},a.id.toString()))}),e.jsx("div",{className:"flex justify-end mt-8 w-full",children:e.jsxs("div",{className:"w-max text-lg px-4 border-t border-gray-400",children:[e.jsxs("div",{className:"w-full grid grid-cols-[max-content_1fr] gap-x-4 gap-y-2 pt-2",children:[e.jsx("div",{className:"font-bold text-right",children:"# Articulos"}),e.jsx("div",{children:p}),e.jsx("div",{className:"font-bold text-right",children:"Envio"}),e.jsx("div",{children:b?"0 creditos":e.jsxs(e.Fragment,{children:[A(p>=22?36:p>=10?18:12)," ","créditos"]})}),e.jsx("div",{className:"font-bold text-right",children:"Subtotal"}),e.jsxs("div",{children:[A(n.reduce((a,i)=>a+Math.ceil(Number(i.sale_price/17))*i.quantity,0),0,"-",!1)," ","créditos"]}),e.jsx("div",{className:"font-bold text-right",children:"Total"}),e.jsxs("div",{children:[" ",g()," créditos"]})]}),e.jsx("div",{className:"w-full mt-2",children:e.jsx("button",{className:"bg-black text-white rounded-full w-full p-2 disabled:bg-gray-400",onClick:()=>v(),disabled:t,children:"Pagar"})})]})}),e.jsx("div",{className:"mt-5",children:e.jsx(ne,{})})]})},I={country:"",state:"",city:"",cp:"",street:"",reference:"",num_ext:"",num_int:"",phone:"",colony:""},de=h=>{const d=T(u=>u.auth.user),[t,s]=l.useState({address:I}),[b,x]=l.useState(!1);l.useEffect(()=>{r()},[]);const n=async()=>{try{if(!t.address.state)throw new Error("Estado es requerido");if(!t.address.city)throw new Error("Ciudad es requerido");if(!t.address.cp)throw new Error("CP es requerido");if(!t.address.street)throw new Error("Calle es requerido");if(!t.address.colony)throw new Error("Colonia es requerido");if(!t.address.phone)throw new Error("Telefono es requerido");if(!t.address.reference)throw new Error("Referencia es requerido");if(!t.address.num_ext)throw new Error("Número exterior es requerido");await M(C(f,`users/${d.uid}/cart/1`),{updated_at:new Date,address:t.address}),h.onComplete()}catch(u){ee.push(e.jsx(se,{title:u.toString(),type:"danger"}),{placement:"top-center"})}},r=async()=>{const u=await F(C(f,`users/${d.uid}/cart/1`));if(u.exists())try{s({address:u.get("address")||I})}catch(m){console.error(m)}},o=u=>m=>{s({...t,address:{...t.address,[u]:m.target.value}})};return e.jsxs("div",{children:[e.jsxs(W,{isOpen:b,onClose:()=>x(!1),children:[e.jsx("p",{className:"text-center font-bold text-xl mb-2",children:"¿Tus datos son correctos?"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 justify-between p-4 rounded-lg",children:[e.jsxs("div",{className:"font-semibold",children:[e.jsx("p",{children:"Estado:"}),e.jsx("p",{children:"Ciudad:"}),e.jsx("p",{children:"Código Postal:"}),e.jsx("p",{children:"Colonia:"}),e.jsx("p",{children:"Calle:"}),e.jsx("p",{children:"Referencias:"}),e.jsx("p",{children:"Teléfono de contacto:"})]}),e.jsxs("div",{children:[e.jsx("p",{children:t.address.state}),e.jsx("p",{children:t.address.city}),e.jsx("p",{children:t.address.cp}),e.jsx("p",{children:t.address.colony}),e.jsx("p",{children:t.address.street}),e.jsx("p",{children:t.address.reference}),e.jsx("p",{children:t.address.phone})]})]}),e.jsxs("div",{className:"flex justify-between mx-4",children:[e.jsx(D,{onClick:()=>x(!1),children:"Regresar"}),e.jsx(D,{onClick:n,children:"Aceptar"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{children:"Páis"}),e.jsx(N,{value:"México",disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Estado"}),e.jsx(N,{name:"state",value:t.address.state,onChange:o("state")})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Ciudad"}),e.jsx(N,{name:"city",value:t.address.city,onChange:o("city")})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Código Postal"}),e.jsx(N,{name:"cp",value:t.address.cp,onChange:o("cp")})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Colonia"}),e.jsx(N,{name:"colony",value:t.address.colony,onChange:o("colony")})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Calle"}),e.jsx(N,{name:"street",value:t.address.street,onChange:o("street")})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Referencias"}),e.jsx(N,{name:"reference",value:t.address.reference,onChange:o("reference"),placeholder:"Entre calles"})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Número Exterior"}),e.jsx(N,{name:"num_ext",value:t.address.num_ext,onChange:o("num_ext")})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Número Interior (Opcional)"}),e.jsx(N,{name:"num_int",value:t.address.num_int,onChange:o("num_int")})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Télefono"}),e.jsx(N,{name:"phone",value:t.address.phone,onChange:o("phone")})]})]}),e.jsxs("div",{className:"flex justify-between mt-8",children:[e.jsxs("span",{className:"underline hover:cursor-pointer",onClick:h.onBack,children:["<"," Regresar al carrito"]}),e.jsx("button",{className:"bg-black text-white rounded-full px-6 py-2",onClick:()=>x(!0),children:"Pagar"})]})]})};function ce(h){const d=te(),t=T(c=>c.auth.user),[s,b]=l.useState([]),[x,n]=l.useState(0),[r,o]=l.useState(),[u,m]=l.useState(!1);l.useEffect(()=>{v()},[]),l.useEffect(()=>{g()},[s]);const v=async()=>{const c=await F(C(f,`users/${t.uid}/cart/1`));if(c.exists()){const y=c.data();o(y);try{const P=JSON.parse(c.get("json"));b(P)}catch(P){console.error(P)}}},g=()=>{let c=0;s.filter(w=>w.quantity).forEach(w=>{c+=Math.ceil(w.sale_price/17)*w.quantity});let y=12;s.some(w=>(w.id===94320904768178||w.id===943209047681782)&&w.quantity>0)?y=0:p>=22?y=36:p>=10&&(y=18);let J=c+y;n(J)},p=s.reduce((c,y)=>c+y.quantity,0),a=async()=>{let c=Number(t.credits)-Number(x);const y=C(f,`users/${t.uid}`);await M(y,{credits:c}),d("/home")},i=async()=>{await O($(f,`users/${t.uid}/pending-ships/`),{cart:r,cartId:"1",created_at:new Date,pack:"none",sent:"false"})},_=async()=>{await re(C(f,`users/${t.uid}/cart/1`))},S=async()=>{await O($(f,`users/${t.uid}/credits-history/`),{id_user:t.uid,email:t.email,name:t.name,total:x,created_at:new Date,concept:"Compra en Marketplace"})},j=async()=>{m(!0);try{await i(),await _(),await S(),await a(),await R()}catch(c){console.error(c)}finally{m(!1)}},R=async()=>{if(!t.uid)return;const c=C(f,"users",t.uid);await M(c,{credits_spent_this_month:ae(Number(x))})};return e.jsxs("div",{children:[e.jsx("p",{className:"font-bold underline underline-offset-8 mb-2 text-lg",children:"Lista de compra"}),e.jsx("div",{className:"grid grid-cols-[min-content_1fr] gap-2 mb-8",children:s.filter(c=>c.quantity).map(c=>e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"font-bold",children:["x",c.quantity]}),e.jsx("span",{children:c.name})]}))}),e.jsx("p",{className:"font-bold underline underline-offset-8 mb-2 text-lg",children:"Total a pagar"}),e.jsx("div",{children:e.jsxs("span",{children:[x," créditos"]})}),e.jsxs("div",{className:"flex justify-between mt-8",children:[e.jsx(D,{className:"bg-black rounded-full px-6 py-2",onClick:h.onBack,children:"Regresar al carrito"}),e.jsx(D,{loading:u,className:"bg-black rounded-full px-6 py-2",onClick:()=>j(),children:"Comprar"})]})]})}const he=()=>{const[h,d]=l.useState("cart"),t=T(n=>n.auth.user),[s,b]=l.useState("");l.useEffect(()=>{x()},[]);const x=async()=>{const n=await F(C(f,`users/${t.uid}/cart/1`));if(n.exists())try{b(n.get("payment_link.status"))}catch(r){console.error(r)}};return l.useEffect(()=>{s=="confirming"&&d("checkout")},[s]),h=="checkout"?e.jsx(ce,{onBack:()=>d("cart")}):h=="form"?e.jsx(de,{onBack:()=>d("cart"),onComplete:()=>d("checkout")}):e.jsx(le,{onComplete:()=>d("form")})};export{he as default};
